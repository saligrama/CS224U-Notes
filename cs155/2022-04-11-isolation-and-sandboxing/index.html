<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Isolation and Sandboxing # Goal: run untrusted code without compromising systems
Programs from untrusted Internet sites Mobile apps, JS, browser extensions Exposed applications: Browser, PDF viewer, email client Legacy daemons: sendmail, bind Honeypots If application misbehaves, want to kill it Approach: confinement # Idea: ensure misbehaving app cannot harm rest of system Can be implemented at many levels Hardware: run application on isolated hardware (airgap) - difficult to manage Virtual machines: isolate OS&rsquo;s on a single machine Process level: system call interposition; isolate a process in a single OS Threads: software fault isolation (SFI) Isolating threads sharing same address space Application level confinement e."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Isolation and Sandboxing # Goal: run untrusted code without compromising systems
Programs from untrusted Internet sites Mobile apps, JS, browser extensions Exposed applications: Browser, PDF viewer, email client Legacy daemons: sendmail, bind Honeypots If application misbehaves, want to kill it Approach: confinement # Idea: ensure misbehaving app cannot harm rest of system Can be implemented at many levels Hardware: run application on isolated hardware (airgap) - difficult to manage Virtual machines: isolate OS&rsquo;s on a single machine Process level: system call interposition; isolate a process in a single OS Threads: software fault isolation (SFI) Isolating threads sharing same address space Application level confinement e."><meta property="og:type" content="article"><meta property="og:url" content="https://saligrama.io/notes/cs155/2022-04-11-isolation-and-sandboxing/"><meta property="article:section" content="cs155"><title>Isolation and Sandboxing | Aditya's notes</title><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.395a67680f48b8d23bbf267f26d0d1259e69554b2b704e371e8e15cbe656e05f.css integrity="sha256-OVpnaA9IuNI7vyZ/JtDRJZ5pVUsrcE43Ho4Vy+ZW4F8=" crossorigin=anonymous><script defer src=/notes/flexsearch.min.js></script>
<script defer src=/notes/en.search.min.da2768c0afef10ea97359689aecf7faf86d2d12a2a7f12aeceeb7b6d413b97a2.js integrity="sha256-2idowK/vEOqXNZaJrs9/r4bS0SoqfxKuzut7bUE7l6I=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><span>Aditya's notes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-a88f46c31d1ebdf165810583424fda37 class=toggle>
<label for=section-a88f46c31d1ebdf165810583424fda37 class="flex justify-between"><a role=button>CS 103, Fall 2020</a></label><ul><li><a href=/notes/cs103/2020-09-16-set-theory/>Set Theory</a></li><li><a href=/notes/cs103/2020-09-18-indirect-proofs/>Indirect Proofs</a></li><li><a href=/notes/cs103/2020-09-18-mathematical-proofs/>Mathematical Proofs</a></li><li><a href=/notes/cs103/2020-09-26-first-order-logic/>First Order Logic</a></li><li><a href=/notes/cs103/2020-09-26-propositional-logic/>Propositional Logic</a></li><li><a href=/notes/cs103/2020-09-27-first-order-logic-continued/>First Order Logic Continued</a></li><li><a href=/notes/cs103/2020-09-30-binary-relations/>Binary Relations</a></li><li><a href=/notes/cs103/2020-10-01-binary-relations-continued/>Binary Relations Continued</a></li><li><a href=/notes/cs103/2020-10-04-functions/>Functions</a></li><li><a href=/notes/cs103/2020-10-10-cardinality/>Cardinality</a></li><li><a href=/notes/cs103/2020-10-11-graph-theory/>Graph Theory</a></li><li><a href=/notes/cs103/2020-10-17-pigeonhole-principle/>Pigeonhole Principle</a></li><li><a href=/notes/cs103/2020-10-18-induction/>Induction</a></li><li><a href=/notes/cs103/2020-10-19-induction-variants/>Induction Variants</a></li><li><a href=/notes/cs103/2020-10-20-computability-and-formal-languages/>Computability and Formal Languages</a></li><li><a href=/notes/cs103/2020-10-25-nondeterministic-finite-automata/>Nondeterministic Finite Automata</a></li><li><a href=/notes/cs103/2020-10-26-nfa-dfa-equivalence/>Nfa Dfa Equivalence</a></li><li><a href=/notes/cs103/2020-10-26-regular-expressions/>Regular Expressions</a></li><li><a href=/notes/cs103/2020-11-01-nonregular-languages/>Nonregular Languages</a></li><li><a href=/notes/cs103/2020-11-02-context-free-grammars/>Context Free Grammars</a></li><li><a href=/notes/cs103/2020-11-03-turing-machines/>Turing Machines</a></li><li><a href=/notes/cs103/2020-11-08-turing-machine-subroutines/>Turing Machine Subroutines</a></li><li><a href=/notes/cs103/2020-11-08-universal-turing-machine/>Universal Turing Machine</a></li><li><a href=/notes/cs103/2020-11-08-unsolvable-problems/>Unsolvable Problems</a></li><li><a href=/notes/cs103/2020-11-14-unsolvable-problems-continued/>Unsolvable Problems Continued</a></li></ul></li><li><input type=checkbox id=section-cf13475a7a80a5dd57b5a55dce73d171 class=toggle>
<label for=section-cf13475a7a80a5dd57b5a55dce73d171 class="flex justify-between"><a role=button>CS 107, Fall 2020</a></label><ul><li><a href=/notes/cs107/2020-09-18-integer-representations/>Integer Representations</a></li><li><a href=/notes/cs107/2020-09-21-bitwise-operations/>Bitwise Operations</a></li><li><a href=/notes/cs107/2020-09-25-c-chars-and-strings/>C Chars and Strings</a></li><li><a href=/notes/cs107/2020-09-28-more-c-strings/>More C Strings</a></li><li><a href=/notes/cs107/2020-10-02-pointers-arrays/>Pointers Arrays</a></li><li><a href=/notes/cs107/2020-10-05-stack-and-heap/>Stack and Heap</a></li><li><a href=/notes/cs107/2020-10-09-c-generics/>C Generics</a></li><li><a href=/notes/cs107/2020-10-12-function-pointers/>Function Pointers</a></li><li><a href=/notes/cs107/2020-10-16-assembly/>Assembly</a></li><li><a href=/notes/cs107/2020-10-19-assembly-arithmetic-logic/>Assembly Arithmetic Logic</a></li><li><a href=/notes/cs107/2020-10-23-assembly-control-flow/>Assembly Control Flow</a></li><li><a href=/notes/cs107/2020-10-26-assembly-function-calls-and-return-stack/>Assembly Function Calls and Return Stack</a></li><li><a href=/notes/cs107/2020-10-30-heap-management/>Heap Management</a></li><li><a href=/notes/cs107/2020-11-09-program-optimization/>Program Optimization</a></li></ul></li><li><input type=checkbox id=section-4e3bc6e2f7a0feae33c3e43356d49c80 class=toggle>
<label for=section-4e3bc6e2f7a0feae33c3e43356d49c80 class="flex justify-between"><a role=button>CS 110L, Spring 2021</a></label><ul><li><a href=/notes/cs110l/2021-03-30-course-overview/>Course Overview</a></li><li><a href=/notes/cs110l/2021-04-01-fixing-c/>Fixing C</a></li><li><a href=/notes/cs110l/2021-04-06-intro-to-rust/>Intro to Rust</a></li><li><a href=/notes/cs110l/2021-04-08-ownership/>Ownership</a></li><li><a href=/notes/cs110l/2021-04-13-error-handling/>Error Handling</a></li><li><a href=/notes/cs110l/2021-04-22-traits/>Traits</a></li><li><a href=/notes/cs110l/2021-04-27-generics/>Generics</a></li><li><a href=/notes/cs110l/2021-04-29-multiprocessing/>Multiprocessing</a></li></ul></li><li><input type=checkbox id=section-23e7773af736437c02202412a988f2db class=toggle>
<label for=section-23e7773af736437c02202412a988f2db class="flex justify-between"><a role=button>CS 111, Spring 2021</a></label><ul><li><a href=/notes/cs111/2021-03-31-threads-and-dispatching/>Threads and Dispatching</a></li><li><a href=/notes/cs111/2021-04-02-concurrency/>Concurrency</a></li><li><a href=/notes/cs111/2021-04-05-synchronization/>Synchronization</a></li><li><a href=/notes/cs111/2021-04-07-shared-memory-and-condition-variables-and-locks/>Shared Memory and Condition Variables and Locks</a></li><li><a href=/notes/cs111/2021-04-09-lock-implementation-and-deadlocking/>Lock Implementation and Deadlocking</a></li><li><a href=/notes/cs111/2021-04-12-scheduling/>Scheduling</a></li><li><a href=/notes/cs111/2021-04-14-multiprocessing/>Multiprocessing</a></li><li><a href=/notes/cs111/2021-04-16-linking/>Linking</a></li><li><a href=/notes/cs111/2021-04-19-storage-management/>Storage Management</a></li><li><a href=/notes/cs111/2021-04-21-virtual-memory/>Virtual Memory</a></li><li><a href=/notes/cs111/2021-04-23-dynamic-address-translation/>Dynamic Address Translation</a></li><li><a href=/notes/cs111/2021-04-26-segmentation-and-paging/>Segmentation and Paging</a></li><li><a href=/notes/cs111/2021-04-30-demand-paging/>Demand Paging</a></li><li><a href=/notes/cs111/2021-05-05-disks/>Disks</a></li><li><a href=/notes/cs111/2021-05-07-file-systems/>File Systems</a></li><li><a href=/notes/cs111/2021-05-10-realworld-filesystem-structures/>Realworld Filesystem Structures</a></li><li><a href=/notes/cs111/2021-05-12-directories/>Directories</a></li><li><a href=/notes/cs111/2021-05-14-crash-recovery/>Crash Recovery</a></li><li><a href=/notes/cs111/2021-05-19-protection/>Protection</a></li><li><a href=/notes/cs111/2021-05-24-flash-memory/>Flash Memory</a></li><li><a href=/notes/cs111/2021-05-28-virtual-machines/>Virtual Machines</a></li></ul></li><li><input type=checkbox id=section-a586b190ebf0a4874cd21a1d76743261 class=toggle>
<label for=section-a586b190ebf0a4874cd21a1d76743261 class="flex justify-between"><a role=button>CS 143, Spring 2022</a></label><ul><li><a href=/notes/cs143/2022-03-29-intro/>Intro</a></li><li><a href=/notes/cs143/2022-03-31-language-design-and-cool/>Language Design and Cool</a></li><li><a href=/notes/cs143/2022-04-05-lexical-analysis/>Lexical Analysis</a></li><li><a href=/notes/cs143/2022-04-07-lexical-analysis-implementation/>Lexical Analysis Implementation</a></li><li><a href=/notes/cs143/2022-04-12-parsing/>Parsing</a></li><li><a href=/notes/cs143/2022-04-14-syntax-directed-translation/>Syntax Directed Translation</a></li><li><a href=/notes/cs143/2022-04-19-top-down-parsing/>Top Down Parsing</a></li><li><a href=/notes/cs143/2022-04-26-semantic-analysis/>Semantic Analysis</a></li></ul></li><li><input type=checkbox id=section-37836de7a703e433b2642097d511f482 class=toggle>
<label for=section-37836de7a703e433b2642097d511f482 class="flex justify-between"><a role=button>CS 149, Fall 2022</a></label><ul><li><a href=/notes/cs149/2022-09-27-intro/>Intro</a></li><li><a href=/notes/cs149/2022-09-29-modern-multicore-processors/>Modern Multicore Processors</a></li><li><a href=/notes/cs149/2022-10-04-parallel-abstractions/>Parallel Abstractions</a></li><li><a href=/notes/cs149/2022-10-06-parallel-models/>Parallel Models</a></li><li><a href=/notes/cs149/2022-10-11-work-distribution-and-scheduling/>Work Distribution and Scheduling</a></li><li><a href=/notes/cs149/2022-10-13-locality-communication-and-contention/>Locality Communication and Contention</a></li><li><a href=/notes/cs149/2022-10-18-gpu-architecture-and-cuda/>Gpu Architecture and Cuda</a></li><li><a href=/notes/cs149/2022-10-20-data-parallel-architecture/>Data Parallel Architecture</a></li><li><a href=/notes/cs149/2022-10-25-spark/>Spark</a></li><li><a href=/notes/cs149/2022-10-27-cache-coherence/>Cache Coherence</a></li><li><a href=/notes/cs149/2022-11-01-memory-consistency/>Memory Consistency</a></li><li><a href=/notes/cs149/2022-11-03-lock-implementation-and-lock-free-programming/>Lock Implementation and Lock Free Programming</a></li><li><a href=/notes/cs149/2022-11-10-transactional-memory/>Transactional Memory</a></li><li><a href=/notes/cs149/2022-11-29-heterogeneous-processing-and-domain-specific-languages/>Heterogeneous Processing and Domain Specific Languages</a></li><li><a href=/notes/cs149/2022-12-06-asics-and-fpgas/>Asics and Fpgas</a></li></ul></li><li><input type=checkbox id=section-4f9fa520660f975442d4640415905b3c class=toggle>
<label for=section-4f9fa520660f975442d4640415905b3c class="flex justify-between"><a role=button>CS 154, Fall 2021</a></label><ul><li><a href=/notes/cs154/2021-09-28-finite-automata/>Finite Automata</a></li><li><a href=/notes/cs154/2021-10-05-pumping-lemma-and-myhill-nerode/>Pumping Lemma and Myhill Nerode</a></li><li><a href=/notes/cs154/2021-10-12-streaming-algorithms-and-turing-machines/>Streaming Algorithms and Turing Machines</a></li></ul></li><li><input type=checkbox id=section-d24cd7d7d21fe73135d596a09b50887f class=toggle checked>
<label for=section-d24cd7d7d21fe73135d596a09b50887f class="flex justify-between"><a role=button>CS 155, Spring 2022</a></label><ul><li><a href=/notes/cs155/2022-03-28-intro/>Intro</a></li><li><a href=/notes/cs155/2022-03-30-control-hijacking/>Control Hijacking</a></li><li><a href=/notes/cs155/2022-04-04-control-hijacking-defenses/>Control Hijacking Defenses</a></li><li><a href=/notes/cs155/2022-04-06-security-principles/>Security Principles</a></li><li><a href=/notes/cs155/2022-04-11-isolation-and-sandboxing/ class=active>Isolation and Sandboxing</a></li><li><a href=/notes/cs155/2022-04-13-vuln-finding/>Vuln Finding</a></li><li><a href=/notes/cs155/2022-04-18-web-security/>Web Security</a></li><li><a href=/notes/cs155/2022-04-20-web-attacks/>Web Attacks</a></li><li><a href=/notes/cs155/2022-04-25-web-defenses/>Web Defenses</a></li><li><a href=/notes/cs155/2022-05-04-processor-security/>Processor Security</a></li><li><a href=/notes/cs155/2022-05-09-internet-protocol-security/>Internet Protocol Security</a></li></ul></li><li><input type=checkbox id=section-471622039e8d87cd8d642483c8d218b8 class=toggle>
<label for=section-471622039e8d87cd8d642483c8d218b8 class="flex justify-between"><a role=button>CS 161, Winter 2022</a></label><ul><li><a href=/notes/cs161/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs161/2022-01-05-worst-case-and-asymptotic-analysis/>Worst Case and Asymptotic Analysis</a></li><li><a href=/notes/cs161/2022-01-10-recurrence-relations/>Recurrence Relations</a></li><li><a href=/notes/cs161/2022-01-12-median-and-selection/>Median and Selection</a></li><li><a href=/notes/cs161/2022-01-19-randomized-algorithms-and-quicksort/>Randomized Algorithms and Quicksort</a></li><li><a href=/notes/cs161/2022-01-24-sorting-lower-bounds/>Sorting Lower Bounds</a></li><li><a href=/notes/cs161/2022-01-26-binary-search-trees/>Binary Search Trees</a></li><li><a href=/notes/cs161/2022-01-31-hashing/>Hashing</a></li><li><a href=/notes/cs161/2022-02-02-graphs-and-graph-search/>Graphs and Graph Search</a></li><li><a href=/notes/cs161/2022-02-07-strongly-connected-components/>Strongly Connected Components</a></li><li><a href=/notes/cs161/2022-02-09-weighted-graphs-and-dijkstra/>Weighted Graphs and Dijkstra</a></li><li><a href=/notes/cs161/2022-02-14-dynamic-programming/>Dynamic Programming</a></li><li><a href=/notes/cs161/2022-02-16-dynamic-programming-applications/>Dynamic Programming Applications</a></li><li><a href=/notes/cs161/2022-02-23-greedy-algorithms/>Greedy Algorithms</a></li><li><a href=/notes/cs161/2022-02-28-minimum-spanning-trees/>Minimum Spanning Trees</a></li></ul></li><li><input type=checkbox id=section-0794dc87987599843ba69a8ea82e9b6a class=toggle>
<label for=section-0794dc87987599843ba69a8ea82e9b6a class="flex justify-between"><a role=button>CS 224U, Spring 2021</a></label><ul><li><a href=/notes/cs224u/2021-03-29-course-overview/>Course Overview</a></li><li><a href=/notes/cs224u/2021-03-31-vector-space-models/>Vector Space Models</a></li><li><a href=/notes/cs224u/2021-04-12-sentiment-analysis/>Sentiment Analysis</a></li></ul></li><li><input type=checkbox id=section-efae8264f5fe410feb1b40be6f99baea class=toggle>
<label for=section-efae8264f5fe410feb1b40be6f99baea class="flex justify-between"><a role=button>CS 229, Fall 2021</a></label><ul><li><a href=/notes/cs229/2021-09-21-intro/>Intro</a></li><li><a href=/notes/cs229/2021-09-23-supervised-learning-setup/>Supervised Learning Setup</a></li><li><a href=/notes/cs229/2021-09-28-logistic-regression/>Logistic Regression</a></li><li><a href=/notes/cs229/2021-09-30-generalized-linear-models/>Generalized Linear Models</a></li><li><a href=/notes/cs229/2021-10-05-generative-learning-algorithms/>Generative Learning Algorithms</a></li><li><a href=/notes/cs229/2021-10-07-naive-bayes/>Naive Bayes</a></li><li><a href=/notes/cs229/2021-10-12-kernel-methods-and-svm/>Kernel Methods and Svm</a></li><li><a href=/notes/cs229/2021-10-14-deep-learning/>Deep Learning</a></li><li><a href=/notes/cs229/2021-10-19-deep-learning-optimization/>Deep Learning Optimization</a></li><li><a href=/notes/cs229/2021-10-21-model-selection/>Model Selection</a></li></ul></li><li><input type=checkbox id=section-58493bdbfe80396f07f44c40ecf068c8 class=toggle>
<label for=section-58493bdbfe80396f07f44c40ecf068c8 class="flex justify-between"><a role=button>CS 249I, Winter 2023</a></label><ul><li><a href=/notes/cs249i/2023-01-09-internet-players/>Internet Players</a></li><li><a href=/notes/cs249i/2023-01-18-modern-routing-practices/>Modern Routing Practices</a></li><li><a href=/notes/cs249i/2023-01-23-last-mile-access/>Last Mile Access</a></li><li><a href=/notes/cs249i/2023-01-25-host-and-network-addressing/>Host and Network Addressing</a></li><li><a href=/notes/cs249i/2023-01-30-domain-name-system/>Domain Name System</a></li></ul></li><li><input type=checkbox id=section-292ea4e126876f1048e61c4dc744546c class=toggle>
<label for=section-292ea4e126876f1048e61c4dc744546c class="flex justify-between"><a role=button>CS 251, Fall 2022</a></label><ul><li><a href=/notes/cs251/2022-09-26-intro/>Intro</a></li><li><a href=/notes/cs251/2022-09-28-bitcoin-mechanics/>Bitcoin Mechanics</a></li><li><a href=/notes/cs251/2022-10-03-bitcoin-scripts-and-wallets/>Bitcoin Scripts and Wallets</a></li><li><a href=/notes/cs251/2022-10-05-consensus/>Consensus</a></li><li><a href=/notes/cs251/2022-10-10-internet-consensus/>Internet Consensus</a></li><li><a href=/notes/cs251/2022-10-17-ethereum/>Ethereum</a></li><li><a href=/notes/cs251/2022-10-19-solidity/>Solidity</a></li><li><a href=/notes/cs251/2022-11-02-legal-aspects-and-regulation/>Legal Aspects and Regulation</a></li><li><a href=/notes/cs251/2022-11-07-privacy-and-deanonymization-and-mixing/>Privacy and Deanonymization and Mixing</a></li><li><a href=/notes/cs251/2022-11-09-privacy-via-zk-snarks/>Privacy via Zk Snarks</a></li></ul></li><li><input type=checkbox id=section-98d861db134658b3e020a9d74c50ad24 class=toggle>
<label for=section-98d861db134658b3e020a9d74c50ad24 class="flex justify-between"><a role=button>CS 255, Winter 2022</a></label><ul><li><a href=/notes/cs255/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs255/2022-01-05-stream-ciphers/>Stream Ciphers</a></li><li><a href=/notes/cs255/2022-01-10-block-ciphers/>Block Ciphers</a></li><li><a href=/notes/cs255/2022-01-12-pseudorandom-functions/>Pseudorandom Functions</a></li><li><a href=/notes/cs255/2022-01-19-data-integrity-and-macs/>Data Integrity and Macs</a></li><li><a href=/notes/cs255/2022-01-24-collision-resistance/>Collision Resistance</a></li><li><a href=/notes/cs255/2022-01-26-authenticated-encryption/>Authenticated Encryption</a></li><li><a href=/notes/cs255/2022-01-31-key-management/>Key Management</a></li><li><a href=/notes/cs255/2022-02-02-key-exchange-math/>Key Exchange Math</a></li><li><a href=/notes/cs255/2022-02-07-public-key-encryption/>Public Key Encryption</a></li><li><a href=/notes/cs255/2022-02-09-pke-schemes/>Pke Schemes</a></li><li><a href=/notes/cs255/2022-02-14-digital-signatures/>Digital Signatures</a></li><li><a href=/notes/cs255/2022-02-16-certificates/>Certificates</a></li><li><a href=/notes/cs255/2022-02-23-id-protocols/>Id Protocols</a></li><li><a href=/notes/cs255/2022-02-28-key-exchange-protocols/>Key Exchange Protocols</a></li><li><a href=/notes/cs255/2022-03-02-zero-knowledge-protocols/>Zero Knowledge Protocols</a></li><li><a href=/notes/cs255/2022-03-07-quantum-cryptography/>Quantum Cryptography</a></li></ul></li><li><input type=checkbox id=section-3c4550884ed49f470e55fabac7077d16 class=toggle>
<label for=section-3c4550884ed49f470e55fabac7077d16 class="flex justify-between"><a role=button>Cs153</a></label><ul><li><a href=/notes/cs153/2023-01-12-intro/>Intro</a></li></ul></li><li><input type=checkbox id=section-568ed1bc8289796d56a6d06a22d7eb40 class=toggle>
<label for=section-568ed1bc8289796d56a6d06a22d7eb40 class="flex justify-between"><a role=button>INTLPOL 268, Fall 2021</a></label><ul><li><a href=/notes/intlpol268/2021-09-20-intro/>Intro</a></li><li><a href=/notes/intlpol268/2021-09-22-legal-intro-and-electronic-communications-privacy-act/>Legal Intro and Electronic Communications Privacy Act</a></li><li><a href=/notes/intlpol268/2021-09-27-web-requests-and-attacks/>Web Requests and Attacks</a></li><li><a href=/notes/intlpol268/2021-09-29-ecpa-for-private-actors/>Ecpa for Private Actors</a></li><li><a href=/notes/intlpol268/2021-10-04-cyberattacks/>Cyberattacks</a></li><li><a href=/notes/intlpol268/2021-10-06-computer-fraud-and-abuse-act/>Computer Fraud and Abuse Act</a></li><li><a href=/notes/intlpol268/2021-10-11-network-security/>Network Security</a></li><li><a href=/notes/intlpol268/2021-10-13-cfaa-dmca-and-security-research/>Cfaa Dmca and Security Research</a></li><li><a href=/notes/intlpol268/2021-10-20-data-security-laws/>Data Security Laws</a></li><li><a href=/notes/intlpol268/2021-10-25-corporate-intrusion/>Corporate Intrusion</a></li><li><a href=/notes/intlpol268/2021-10-27-ransomware-and-foreign-hackers/>Ransomware and Foreign Hackers</a></li><li><a href=/notes/intlpol268/2021-11-01-cryptography/>Cryptography</a></li><li><a href=/notes/intlpol268/2021-11-03-cyber-conflict/>Cyber Conflict</a></li><li><a href=/notes/intlpol268/2021-11-08-dark-web-and-cryptocurrencies/>Dark Web and Cryptocurrencies</a></li><li><a href=/notes/intlpol268/2021-11-10-encryption-and-technical-assistance/>Encryption and Technical Assistance</a></li><li><a href=/notes/intlpol268/2021-11-15-malware/>Malware</a></li><li><a href=/notes/intlpol268/2021-11-17-government-hacking/>Government Hacking</a></li><li><a href=/notes/intlpol268/2021-11-29-new-frontiers/>New Frontiers</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Isolation and Sandboxing</strong>
<label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#isolation-and-sandboxing>Isolation and Sandboxing</a></li><li><a href=#approach-confinement>Approach: confinement</a><ul><li><a href=#implementation>Implementation</a></li><li><a href=#example-chroot-jail>Example: <code>chroot</code> jail</a><ul><li><a href=#freebsd-jail>FreeBSD jail</a></li><li><a href=#problems-with-chroot-jails>Problems with <code>chroot</code> jails</a></li></ul></li><li><a href=#system-call-interposition>System call interposition</a><ul><li><a href=#early-implementation-janus-1996>Early implementation: Janus (1996)</a></li><li><a href=#sci-in-linux-seccomp-bpf>SCI in Linux: <code>seccomp-bpf</code></a><ul><li><a href=#bpf-filters-policy-programs>BPF filters (policy programs):</a></li><li><a href=#installing-a-bpf-filter>Installing a BPF filter</a></li><li><a href=#docker-isolating-containers-using-seccomp-bpf>Docker: isolating containers using <code>seccomp-bpf</code></a></li></ul></li></ul></li><li><a href=#confinement-via-virtual-machines>Confinement via virtual machines</a><ul><li><a href=#hypervisor-security-assumption>Hypervisor security assumption</a></li><li><a href=#problem-covert-channels>Problem: covert channels</a></li><li><a href=#vms-in-end-user-environments>VMs in end-user environments</a></li><li><a href=#hypervisor-detection>Hypervisor detection</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=isolation-and-sandboxing>Isolation and Sandboxing
<a class=anchor href=#isolation-and-sandboxing>#</a></h1><p>Goal: run untrusted code without compromising systems</p><ul><li>Programs from untrusted Internet sites<ul><li>Mobile apps, JS, browser extensions</li></ul></li><li>Exposed applications: Browser, PDF viewer, email client</li><li>Legacy daemons: sendmail, bind</li><li>Honeypots</li><li>If application misbehaves, want to kill it</li></ul><h1 id=approach-confinement>Approach: confinement
<a class=anchor href=#approach-confinement>#</a></h1><ul><li>Idea: ensure misbehaving app cannot harm rest of system</li><li>Can be implemented at many levels<ul><li>Hardware: run application on isolated hardware (airgap) - difficult to manage</li><li>Virtual machines: isolate OS&rsquo;s on a single machine</li><li>Process level: system call interposition; isolate a process in a single OS</li><li>Threads: software fault isolation (SFI)<ul><li>Isolating threads sharing same address space</li></ul></li><li>Application level confinement<ul><li>e.g. browser sandbox for Javascript and WebAssembly</li></ul></li></ul></li></ul><h2 id=implementation>Implementation
<a class=anchor href=#implementation>#</a></h2><p>Key component: reference monitor</p><ul><li>Mediates requests from applications<ul><li>Enforces confinement</li><li>Implements a specified protection policy</li></ul></li><li>Must <em>always</em> be invoked; every application request must be mediated</li><li>Tamperproof: reference monitor cannot be killed; if it is, then monitored process is also killed</li></ul><h2 id=example-chroot-jail>Example: <code>chroot</code> jail
<a class=anchor href=#example-chroot-jail>#</a></h2><p>To use (must be root):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chroot /tmp/guest
</span></span><span style=display:flex><span>su guest
</span></span></code></pre></div><ul><li>Root dir <code>/</code> is now <code>/tmp/guest</code></li><li>EUID set to <code>guest</code></li><li>Now <code>/tmp/guest</code> is added to every file system access<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#50fa7b>fopen</span>(&#39;<span style=color:#ff79c6>/</span>etc<span style=color:#ff79c6>/</span>passwd&#39;, <span style=color:#f1fa8c>&#39;r&#39;</span>); <span style=color:#6272a4>// becomes the below:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#50fa7b>fopen</span>(&#39;<span style=color:#ff79c6>/</span>tmp<span style=color:#ff79c6>/</span>guest<span style=color:#ff79c6>/</span>etc<span style=color:#ff79c6>/</span>passwd&#39;, <span style=color:#f1fa8c>&#39;r&#39;</span>);
</span></span></code></pre></div></li><li><code>chroot</code> should only be executable by <code>root</code>, otherwise jailed app can do<ul><li>Create dummy file <code>/aaa/etc/passwd</code></li><li>Run <code>chroot /aaa</code></li><li>Run <code>su root</code> to become <code>root</code></li><li>Many ways to escape jail as <code>root</code>:<ul><li>Create device that lets you access raw disk</li><li>Send signals to non-<code>chroot</code>ed process</li><li>Reboot system</li><li>Bind to privileged ports</li></ul></li></ul></li></ul><h3 id=freebsd-jail>FreeBSD jail
<a class=anchor href=#freebsd-jail>#</a></h3><ul><li>Stronger mechanism than simple <code>chroot</code></li><li>To run: <code>jail [jail-path] [hostname] [IP-addr] [cmd]</code><ul><li>Calls hardened <code>chroot</code> (no <code>../../</code> escape)</li><li>Can only bind to sockets with specified IP addresses and authorized ports</li><li>Can only comunicated with processes inside jail</li><li>Root is limited, e.g. cannot load kernel modules</li></ul></li></ul><h3 id=problems-with-chroot-jails>Problems with <code>chroot</code> jails
<a class=anchor href=#problems-with-chroot-jails>#</a></h3><ul><li>Coarse policies: all or nothing access to parts of a file system<ul><li>Inappropriate for apps like web browsers, which need access to files outside jail (e.g. for sending attachments over email)</li></ul></li><li>Does not prevent malicious apps from<ul><li>Accessing network and messing with other machines</li><li>Trying to crash host OS</li></ul></li></ul><h2 id=system-call-interposition>System call interposition
<a class=anchor href=#system-call-interposition>#</a></h2><ul><li>Observation: to damage host system (e.g. persistent changes), app must make system calls<ul><li>To delete/overwrite files: <code>unlink</code>, <code>open</code>, <code>write</code></li><li>To do network attacks: <code>socket</code>, <code>bind</code>, <code>connect</code>, <code>send</code></li></ul></li><li>Idea: monitor app&rsquo;s system calls and block unauthorized calls</li><li>Implementation options<ul><li>Completely kernel-space (e.g., Linux <code>seccomp</code>)</li><li>Completely user-space (e.g., program shepherding)</li><li>Hybrid (e.g. <code>systrace</code>)</li></ul></li></ul><h3 id=early-implementation-janus-1996>Early implementation: Janus (1996)
<a class=anchor href=#early-implementation-janus-1996>#</a></h3><ul><li>Linux <code>ptrace</code>: process tracing<ul><li>Process calls <code>ptrace(..., pid_t pid, ...)</code> and wakes up when <code>pid</code> makes system call</li></ul></li><li>If monitored process calls <code>fopen</code>, monitor decides if application is allowed, if not, monitor kills application</li><li>Example policy (e.g., for PDF reader)<pre tabindex=0><code>path allow /tmp/*
path deny /etc/passwd
network deny all
</code></pre></li><li>Manually specifying policy for an app can be difficult<ul><li>Recommended default policies are available, can be made more restrictive as needed</li></ul></li><li>Complications<ul><li>If app forks, monitor must also fork; forked monitor monitors forked app</li><li>If monitor crashes, app must be killed</li><li>Monitor must maintain all OS state associated with the app<ul><li>Current working directory, UID, EUID, GID</li><li>When app does <code>cd path</code> monitor must update its CWD</li></ul></li><li>Problems with <code>ptrace</code>:<ul><li>Trace all system calls, which can be inefficient: no need to trace <code>close</code> system call</li><li>Monitor can abort syscall without killing app</li></ul></li><li>Race conditions (time of check/time of use - TOCTOU bug) since checking/opening is not atomic<ol><li>Proc 1: <code>open("me")</code></li><li>Monitor checks and authorizes</li><li>Proc 2: symlink <code>me</code> to <code>/etc/passwd</code></li><li>OS executes <code>open("me")</code></li></ol></li></ul></li></ul><h3 id=sci-in-linux-seccomp-bpf>SCI in Linux: <code>seccomp-bpf</code>
<a class=anchor href=#sci-in-linux-seccomp-bpf>#</a></h3><ul><li><code>seccomp-bpf</code>: Linux kernel facility used to filter process syscalls<ul><li>Syscall filters written in BPF language (use BPFC compiler)</li><li>Used in Chromium, Docker containers, etc.</li></ul></li><li>How this works:<ol><li>Chrome renderer process starts<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#50fa7b>prctl</span>(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, <span style=color:#ff79c6>&amp;</span>bpf_policy)
</span></span></code></pre></div></li><li>Renderer process renders site</li><li>If due to exploit the process tries to do<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#50fa7b>fopen</span>(<span style=color:#f1fa8c>&#34;/etc/passwd&#34;</span>, <span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span></code></pre></div>then <code>seccomp-bpf</code> will kill process</li></ol></li></ul><h4 id=bpf-filters-policy-programs>BPF filters (policy programs):
<a class=anchor href=#bpf-filters-policy-programs>#</a></h4><ul><li>Process can install multiple BPF filters</li><li>Once installed, filter cannot be removed - all run on every syscall</li><li>If process forks, child inherits all filters</li><li>If program calls <code>execve</code>, all filters are preserved</li><li>BPF filter input: syscall number, syscall args., system architecture</li><li>Filter returns one of<ul><li><code>SECCOMP_RET_KILL</code>: kill process</li><li><code>SECCOMP_RET_ERRNO</code>: return specified error to caller</li><li><code>SECCOMP_RET_ALLOW</code>: allow syscall</li></ul></li></ul><h4 id=installing-a-bpf-filter>Installing a BPF filter
<a class=anchor href=#installing-a-bpf-filter>#</a></h4><ul><li>Must be called before setting BPF filter</li><li>Ensures <code>setuid</code>, <code>setgid</code> ignored on subsequent <code>execve</code><ul><li>Attacker cannot elevate privilege</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span> (<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv) {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>prctl</span>(PR_SET_NO_NEW_PRIVS, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// kill if call open() for write
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>prctl</span>(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, <span style=color:#ff79c6>&amp;</span>bpf_policy);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>fopen</span>(<span style=color:#f1fa8c>&#34;file.txt,&#34;</span> <span style=color:#f1fa8c>&#34;w&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>assert</span>(<span style=color:#8be9fd;font-style:italic>false</span>); <span style=color:#6272a4>// should never reach here
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h4 id=docker-isolating-containers-using-seccomp-bpf>Docker: isolating containers using <code>seccomp-bpf</code>
<a class=anchor href=#docker-isolating-containers-using-seccomp-bpf>#</a></h4><p>Container: process-level isolation</p><ul><li>Container prevented from making syscalls filtered by <code>seccomp-bpf</code></li><li>Whoever starts container can specify BPF policy<ul><li>default policy blocks many syscalls, including <code>ptrace</code></li></ul></li><li>e.g. Nginx: <code>docker run --security-opt="seccomp=filter.json" nginx</code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f1fa8c>&#34;defaultAction&#34;</span>: <span style=color:#f1fa8c>&#34;SCMP_ACT_ERRNO.&#34;</span> <span style=color:#6272a4>// deny by default
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#f1fa8c>&#34;syscalls&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;names&#34;</span>: [<span style=color:#f1fa8c>&#34;accept&#34;</span>], <span style=color:#6272a4>// syscall name
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>&#34;action&#34;</span>: <span style=color:#f1fa8c>&#34;SCMP_ACT_ALLOW&#34;</span>, <span style=color:#6272a4>// allow (whitelist)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>&#34;args&#34;</span>: [] <span style=color:#6272a4>// what args to allow
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    },
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>]
</span></span></code></pre></div></li><li>More Docker confinement flags:<ul><li>Specify an unprivileged user:<ul><li><code>docker run --user www nginx</code></li></ul></li><li>Limit Linux capabilities: drop all capabilities, allow bind to privileged ports:<ul><li><code>docker run --cap-drop all --cap-add NET_BIND_SERVICE nginx</code></li></ul></li><li>Prevent process from becoming privileged (e.g. by a <code>setuid</code> binary)<ul><li><code>docker run --security-opt=no-new-privileges:true nginx</code></li></ul></li><li>Limit number of restarts and resources<ul><li><code>docker run --restart=on_failure:$MAX_RETRIES --ulimit nofile=$MAX_FD --ulimit nproc=$MAX_NPROC nginx</code></li></ul></li></ul></li></ul><h2 id=confinement-via-virtual-machines>Confinement via virtual machines
<a class=anchor href=#confinement-via-virtual-machines>#</a></h2><p>About VMs: <a href=../CS111/2021-05-28-virtual-machines.md>see my notes from CS 111</a></p><h3 id=hypervisor-security-assumption>Hypervisor security assumption
<a class=anchor href=#hypervisor-security-assumption>#</a></h3><ul><li>Malware can infect <em>guest</em> OS and guest apps</li><li>But malware cannot escape from the infected VM<ul><li>Cannot infect host OS or other VMs on the same hardware</li></ul></li><li>Requires that hypervisor protects itself and is not buggy<ul><li>Some hypervisors are much simpler than a full OS</li></ul></li></ul><h3 id=problem-covert-channels>Problem: covert channels
<a class=anchor href=#problem-covert-channels>#</a></h3><ul><li>Unintended communication channel between isolated components</li><li>Can leak classified data from secure component to public component</li><li>Example communication between cooperating malware and listener<ul><li>To send a bit, malware does<ul><li><code>b = 1</code>: at 1:00am, do CPU intensive calculation</li><li><code>b = 0</code>: at 1:00am, do nothing</li></ul></li><li>At 1:00am, listener does CPU intensive calculation and measures completion time<ul><li><code>b = 1</code>: completion time > threshold</li></ul></li></ul></li></ul><ul><li>Many covert channels exist in running system<ul><li>File lock status, cache contents, interrupts, etc.</li><li>Difficult to eliminate all</li></ul></li></ul><ul><li>VMs from different customers may run on same machine in the cloud<ul><li>However, some data may leak</li></ul></li></ul><h3 id=vms-in-end-user-environments>VMs in end-user environments
<a class=anchor href=#vms-in-end-user-environments>#</a></h3><ul><li>Qubes OS: a desktop/laptop OS where everything is a VM<ul><li>Runs on Xen hypervisor</li><li>Access to peripherals (mic, camera, USBs, &mldr;) controlled by VMs</li><li>Every window frame identifies VM source</li></ul></li></ul><h3 id=hypervisor-detection>Hypervisor detection
<a class=anchor href=#hypervisor-detection>#</a></h3><ul><li>Malware can detect hypervisor and refuse to run to avoid reverse-engineering</li><li>Software that binds to hardware can refuse to run in VM</li><li>DRM systems may refuse to run on top of hypervisor</li><li>How to detect?<ul><li>VM platforms often emulate simple hardware (e.g. i440bx chipset) but reports 8GB RAM, dual CPUs, etc</li><li>Hypervisor introduces time latency variances<ul><li>Memory cache behavior differs in presence of hypervisor</li><li>Results in relative time for any two operations</li></ul></li><li>Hypervisor shares TLB with guest OS<ul><li>Guest OS can detect reduced TLB size</li></ul></li><li>Can do detection in the browser<ul><li>Timing variations in writing to the screen</li><li>Disadvantages identification of malware websites using VMs</li></ul></li></ul></li><li>The perfect hypervisor does not exist<ul><li>Hypervisors today focus on compatibility (ensuring off-the-shelf software works) and performance (minimizing virtualization overhead)</li><li>VMMs do not provide transparency - anomalies reveal existence of hypervisor</li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#isolation-and-sandboxing>Isolation and Sandboxing</a></li><li><a href=#approach-confinement>Approach: confinement</a><ul><li><a href=#implementation>Implementation</a></li><li><a href=#example-chroot-jail>Example: <code>chroot</code> jail</a><ul><li><a href=#freebsd-jail>FreeBSD jail</a></li><li><a href=#problems-with-chroot-jails>Problems with <code>chroot</code> jails</a></li></ul></li><li><a href=#system-call-interposition>System call interposition</a><ul><li><a href=#early-implementation-janus-1996>Early implementation: Janus (1996)</a></li><li><a href=#sci-in-linux-seccomp-bpf>SCI in Linux: <code>seccomp-bpf</code></a><ul><li><a href=#bpf-filters-policy-programs>BPF filters (policy programs):</a></li><li><a href=#installing-a-bpf-filter>Installing a BPF filter</a></li><li><a href=#docker-isolating-containers-using-seccomp-bpf>Docker: isolating containers using <code>seccomp-bpf</code></a></li></ul></li></ul></li><li><a href=#confinement-via-virtual-machines>Confinement via virtual machines</a><ul><li><a href=#hypervisor-security-assumption>Hypervisor security assumption</a></li><li><a href=#problem-covert-channels>Problem: covert channels</a></li><li><a href=#vms-in-end-user-environments>VMs in end-user environments</a></li><li><a href=#hypervisor-detection>Hypervisor detection</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>