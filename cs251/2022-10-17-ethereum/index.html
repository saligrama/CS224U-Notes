<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ethereum # Limitations of Bitcoin # UTXO contains ScriptPK or hash thereof Simple script: indicates conditions when UTXO can be spent However: difficult to maintain state in multi-stage contracts or to enforce global rules on assets e.g. rate limiting: if wallet has 100 UTXOs, and want to enforce transfer of max 2BTC per day out of wallet, this is impossible! Example: NameCoin # DNS on the blockchain Need operations: Name."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Ethereum # Limitations of Bitcoin # UTXO contains ScriptPK or hash thereof Simple script: indicates conditions when UTXO can be spent However: difficult to maintain state in multi-stage contracts or to enforce global rules on assets e.g. rate limiting: if wallet has 100 UTXOs, and want to enforce transfer of max 2BTC per day out of wallet, this is impossible! Example: NameCoin # DNS on the blockchain Need operations: Name."><meta property="og:type" content="article"><meta property="og:url" content="https://saligrama.io/notes/cs251/2022-10-17-ethereum/"><meta property="article:section" content="cs251"><title>Ethereum | Aditya's notes</title><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.395a67680f48b8d23bbf267f26d0d1259e69554b2b704e371e8e15cbe656e05f.css integrity="sha256-OVpnaA9IuNI7vyZ/JtDRJZ5pVUsrcE43Ho4Vy+ZW4F8=" crossorigin=anonymous><script defer src=/notes/flexsearch.min.js></script>
<script defer src=/notes/en.search.min.8559063499cfd5c826524434e1a9e219fe0dea19bc655f26497621d4f7310f4f.js integrity="sha256-hVkGNJnP1cgmUkQ04aniGf4N6hm8ZV8mSXYh1PcxD08=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><span>Aditya's notes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-a88f46c31d1ebdf165810583424fda37 class=toggle>
<label for=section-a88f46c31d1ebdf165810583424fda37 class="flex justify-between"><a role=button>CS 103, Fall 2020</a></label><ul><li><a href=/notes/cs103/2020-09-16-set-theory/>Set Theory</a></li><li><a href=/notes/cs103/2020-09-18-indirect-proofs/>Indirect Proofs</a></li><li><a href=/notes/cs103/2020-09-18-mathematical-proofs/>Mathematical Proofs</a></li><li><a href=/notes/cs103/2020-09-26-first-order-logic/>First Order Logic</a></li><li><a href=/notes/cs103/2020-09-26-propositional-logic/>Propositional Logic</a></li><li><a href=/notes/cs103/2020-09-27-first-order-logic-continued/>First Order Logic Continued</a></li><li><a href=/notes/cs103/2020-09-30-binary-relations/>Binary Relations</a></li><li><a href=/notes/cs103/2020-10-01-binary-relations-continued/>Binary Relations Continued</a></li><li><a href=/notes/cs103/2020-10-04-functions/>Functions</a></li><li><a href=/notes/cs103/2020-10-10-cardinality/>Cardinality</a></li><li><a href=/notes/cs103/2020-10-11-graph-theory/>Graph Theory</a></li><li><a href=/notes/cs103/2020-10-17-pigeonhole-principle/>Pigeonhole Principle</a></li><li><a href=/notes/cs103/2020-10-18-induction/>Induction</a></li><li><a href=/notes/cs103/2020-10-19-induction-variants/>Induction Variants</a></li><li><a href=/notes/cs103/2020-10-20-computability-and-formal-languages/>Computability and Formal Languages</a></li><li><a href=/notes/cs103/2020-10-25-nondeterministic-finite-automata/>Nondeterministic Finite Automata</a></li><li><a href=/notes/cs103/2020-10-26-nfa-dfa-equivalence/>Nfa Dfa Equivalence</a></li><li><a href=/notes/cs103/2020-10-26-regular-expressions/>Regular Expressions</a></li><li><a href=/notes/cs103/2020-11-01-nonregular-languages/>Nonregular Languages</a></li><li><a href=/notes/cs103/2020-11-02-context-free-grammars/>Context Free Grammars</a></li><li><a href=/notes/cs103/2020-11-03-turing-machines/>Turing Machines</a></li><li><a href=/notes/cs103/2020-11-08-turing-machine-subroutines/>Turing Machine Subroutines</a></li><li><a href=/notes/cs103/2020-11-08-universal-turing-machine/>Universal Turing Machine</a></li><li><a href=/notes/cs103/2020-11-08-unsolvable-problems/>Unsolvable Problems</a></li><li><a href=/notes/cs103/2020-11-14-unsolvable-problems-continued/>Unsolvable Problems Continued</a></li></ul></li><li><input type=checkbox id=section-cf13475a7a80a5dd57b5a55dce73d171 class=toggle>
<label for=section-cf13475a7a80a5dd57b5a55dce73d171 class="flex justify-between"><a role=button>CS 107, Fall 2020</a></label><ul><li><a href=/notes/cs107/2020-09-18-integer-representations/>Integer Representations</a></li><li><a href=/notes/cs107/2020-09-21-bitwise-operations/>Bitwise Operations</a></li><li><a href=/notes/cs107/2020-09-25-c-chars-and-strings/>C Chars and Strings</a></li><li><a href=/notes/cs107/2020-09-28-more-c-strings/>More C Strings</a></li><li><a href=/notes/cs107/2020-10-02-pointers-arrays/>Pointers Arrays</a></li><li><a href=/notes/cs107/2020-10-05-stack-and-heap/>Stack and Heap</a></li><li><a href=/notes/cs107/2020-10-09-c-generics/>C Generics</a></li><li><a href=/notes/cs107/2020-10-12-function-pointers/>Function Pointers</a></li><li><a href=/notes/cs107/2020-10-16-assembly/>Assembly</a></li><li><a href=/notes/cs107/2020-10-19-assembly-arithmetic-logic/>Assembly Arithmetic Logic</a></li><li><a href=/notes/cs107/2020-10-23-assembly-control-flow/>Assembly Control Flow</a></li><li><a href=/notes/cs107/2020-10-26-assembly-function-calls-and-return-stack/>Assembly Function Calls and Return Stack</a></li><li><a href=/notes/cs107/2020-10-30-heap-management/>Heap Management</a></li><li><a href=/notes/cs107/2020-11-09-program-optimization/>Program Optimization</a></li></ul></li><li><input type=checkbox id=section-4e3bc6e2f7a0feae33c3e43356d49c80 class=toggle>
<label for=section-4e3bc6e2f7a0feae33c3e43356d49c80 class="flex justify-between"><a role=button>CS 110L, Spring 2021</a></label><ul><li><a href=/notes/cs110l/2021-03-30-course-overview/>Course Overview</a></li><li><a href=/notes/cs110l/2021-04-01-fixing-c/>Fixing C</a></li><li><a href=/notes/cs110l/2021-04-06-intro-to-rust/>Intro to Rust</a></li><li><a href=/notes/cs110l/2021-04-08-ownership/>Ownership</a></li><li><a href=/notes/cs110l/2021-04-13-error-handling/>Error Handling</a></li><li><a href=/notes/cs110l/2021-04-22-traits/>Traits</a></li><li><a href=/notes/cs110l/2021-04-27-generics/>Generics</a></li><li><a href=/notes/cs110l/2021-04-29-multiprocessing/>Multiprocessing</a></li></ul></li><li><input type=checkbox id=section-23e7773af736437c02202412a988f2db class=toggle>
<label for=section-23e7773af736437c02202412a988f2db class="flex justify-between"><a role=button>CS 111, Spring 2021</a></label><ul><li><a href=/notes/cs111/2021-03-31-threads-and-dispatching/>Threads and Dispatching</a></li><li><a href=/notes/cs111/2021-04-02-concurrency/>Concurrency</a></li><li><a href=/notes/cs111/2021-04-05-synchronization/>Synchronization</a></li><li><a href=/notes/cs111/2021-04-07-shared-memory-and-condition-variables-and-locks/>Shared Memory and Condition Variables and Locks</a></li><li><a href=/notes/cs111/2021-04-09-lock-implementation-and-deadlocking/>Lock Implementation and Deadlocking</a></li><li><a href=/notes/cs111/2021-04-12-scheduling/>Scheduling</a></li><li><a href=/notes/cs111/2021-04-14-multiprocessing/>Multiprocessing</a></li><li><a href=/notes/cs111/2021-04-16-linking/>Linking</a></li><li><a href=/notes/cs111/2021-04-19-storage-management/>Storage Management</a></li><li><a href=/notes/cs111/2021-04-21-virtual-memory/>Virtual Memory</a></li><li><a href=/notes/cs111/2021-04-23-dynamic-address-translation/>Dynamic Address Translation</a></li><li><a href=/notes/cs111/2021-04-26-segmentation-and-paging/>Segmentation and Paging</a></li><li><a href=/notes/cs111/2021-04-30-demand-paging/>Demand Paging</a></li><li><a href=/notes/cs111/2021-05-05-disks/>Disks</a></li><li><a href=/notes/cs111/2021-05-07-file-systems/>File Systems</a></li><li><a href=/notes/cs111/2021-05-10-realworld-filesystem-structures/>Realworld Filesystem Structures</a></li><li><a href=/notes/cs111/2021-05-12-directories/>Directories</a></li><li><a href=/notes/cs111/2021-05-14-crash-recovery/>Crash Recovery</a></li><li><a href=/notes/cs111/2021-05-19-protection/>Protection</a></li><li><a href=/notes/cs111/2021-05-24-flash-memory/>Flash Memory</a></li><li><a href=/notes/cs111/2021-05-28-virtual-machines/>Virtual Machines</a></li></ul></li><li><input type=checkbox id=section-a586b190ebf0a4874cd21a1d76743261 class=toggle>
<label for=section-a586b190ebf0a4874cd21a1d76743261 class="flex justify-between"><a role=button>CS 143, Spring 2022</a></label><ul><li><a href=/notes/cs143/2022-03-29-intro/>Intro</a></li><li><a href=/notes/cs143/2022-03-31-language-design-and-cool/>Language Design and Cool</a></li><li><a href=/notes/cs143/2022-04-05-lexical-analysis/>Lexical Analysis</a></li><li><a href=/notes/cs143/2022-04-07-lexical-analysis-implementation/>Lexical Analysis Implementation</a></li><li><a href=/notes/cs143/2022-04-12-parsing/>Parsing</a></li><li><a href=/notes/cs143/2022-04-14-syntax-directed-translation/>Syntax Directed Translation</a></li><li><a href=/notes/cs143/2022-04-19-top-down-parsing/>Top Down Parsing</a></li><li><a href=/notes/cs143/2022-04-26-semantic-analysis/>Semantic Analysis</a></li></ul></li><li><input type=checkbox id=section-37836de7a703e433b2642097d511f482 class=toggle>
<label for=section-37836de7a703e433b2642097d511f482 class="flex justify-between"><a role=button>CS 149, Fall 2022</a></label><ul><li><a href=/notes/cs149/2022-09-27-intro/>Intro</a></li><li><a href=/notes/cs149/2022-09-29-modern-multicore-processors/>Modern Multicore Processors</a></li><li><a href=/notes/cs149/2022-10-04-parallel-abstractions/>Parallel Abstractions</a></li><li><a href=/notes/cs149/2022-10-06-parallel-models/>Parallel Models</a></li><li><a href=/notes/cs149/2022-10-11-work-distribution-and-scheduling/>Work Distribution and Scheduling</a></li><li><a href=/notes/cs149/2022-10-13-locality-communication-and-contention/>Locality Communication and Contention</a></li><li><a href=/notes/cs149/2022-10-18-gpu-architecture-and-cuda/>Gpu Architecture and Cuda</a></li><li><a href=/notes/cs149/2022-10-20-data-parallel-architecture/>Data Parallel Architecture</a></li><li><a href=/notes/cs149/2022-10-25-spark/>Spark</a></li><li><a href=/notes/cs149/2022-10-27-cache-coherence/>Cache Coherence</a></li><li><a href=/notes/cs149/2022-11-01-memory-consistency/>Memory Consistency</a></li><li><a href=/notes/cs149/2022-11-03-lock-implementation-and-lock-free-programming/>Lock Implementation and Lock Free Programming</a></li><li><a href=/notes/cs149/2022-11-10-transactional-memory/>Transactional Memory</a></li></ul></li><li><input type=checkbox id=section-4f9fa520660f975442d4640415905b3c class=toggle>
<label for=section-4f9fa520660f975442d4640415905b3c class="flex justify-between"><a role=button>CS 154, Fall 2021</a></label><ul><li><a href=/notes/cs154/2021-09-28-finite-automata/>Finite Automata</a></li><li><a href=/notes/cs154/2021-10-05-pumping-lemma-and-myhill-nerode/>Pumping Lemma and Myhill Nerode</a></li><li><a href=/notes/cs154/2021-10-12-streaming-algorithms-and-turing-machines/>Streaming Algorithms and Turing Machines</a></li></ul></li><li><input type=checkbox id=section-d24cd7d7d21fe73135d596a09b50887f class=toggle>
<label for=section-d24cd7d7d21fe73135d596a09b50887f class="flex justify-between"><a role=button>CS 155, Spring 2022</a></label><ul><li><a href=/notes/cs155/2022-03-28-intro/>Intro</a></li><li><a href=/notes/cs155/2022-03-30-control-hijacking/>Control Hijacking</a></li><li><a href=/notes/cs155/2022-04-04-control-hijacking-defenses/>Control Hijacking Defenses</a></li><li><a href=/notes/cs155/2022-04-06-security-principles/>Security Principles</a></li><li><a href=/notes/cs155/2022-04-11-isolation-and-sandboxing/>Isolation and Sandboxing</a></li><li><a href=/notes/cs155/2022-04-13-vuln-finding/>Vuln Finding</a></li><li><a href=/notes/cs155/2022-04-18-web-security/>Web Security</a></li><li><a href=/notes/cs155/2022-04-20-web-attacks/>Web Attacks</a></li><li><a href=/notes/cs155/2022-04-25-web-defenses/>Web Defenses</a></li><li><a href=/notes/cs155/2022-05-04-processor-security/>Processor Security</a></li><li><a href=/notes/cs155/2022-05-09-internet-protocol-security/>Internet Protocol Security</a></li></ul></li><li><input type=checkbox id=section-471622039e8d87cd8d642483c8d218b8 class=toggle>
<label for=section-471622039e8d87cd8d642483c8d218b8 class="flex justify-between"><a role=button>CS 161, Winter 2022</a></label><ul><li><a href=/notes/cs161/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs161/2022-01-05-worst-case-and-asymptotic-analysis/>Worst Case and Asymptotic Analysis</a></li><li><a href=/notes/cs161/2022-01-10-recurrence-relations/>Recurrence Relations</a></li><li><a href=/notes/cs161/2022-01-12-median-and-selection/>Median and Selection</a></li><li><a href=/notes/cs161/2022-01-19-randomized-algorithms-and-quicksort/>Randomized Algorithms and Quicksort</a></li><li><a href=/notes/cs161/2022-01-24-sorting-lower-bounds/>Sorting Lower Bounds</a></li><li><a href=/notes/cs161/2022-01-26-binary-search-trees/>Binary Search Trees</a></li><li><a href=/notes/cs161/2022-01-31-hashing/>Hashing</a></li><li><a href=/notes/cs161/2022-02-02-graphs-and-graph-search/>Graphs and Graph Search</a></li><li><a href=/notes/cs161/2022-02-07-strongly-connected-components/>Strongly Connected Components</a></li><li><a href=/notes/cs161/2022-02-09-weighted-graphs-and-dijkstra/>Weighted Graphs and Dijkstra</a></li><li><a href=/notes/cs161/2022-02-14-dynamic-programming/>Dynamic Programming</a></li><li><a href=/notes/cs161/2022-02-16-dynamic-programming-applications/>Dynamic Programming Applications</a></li><li><a href=/notes/cs161/2022-02-23-greedy-algorithms/>Greedy Algorithms</a></li><li><a href=/notes/cs161/2022-02-28-minimum-spanning-trees/>Minimum Spanning Trees</a></li></ul></li><li><input type=checkbox id=section-0794dc87987599843ba69a8ea82e9b6a class=toggle>
<label for=section-0794dc87987599843ba69a8ea82e9b6a class="flex justify-between"><a role=button>CS 224U, Spring 2021</a></label><ul><li><a href=/notes/cs224u/2021-03-29-course-overview/>Course Overview</a></li><li><a href=/notes/cs224u/2021-03-31-vector-space-models/>Vector Space Models</a></li><li><a href=/notes/cs224u/2021-04-12-sentiment-analysis/>Sentiment Analysis</a></li></ul></li><li><input type=checkbox id=section-efae8264f5fe410feb1b40be6f99baea class=toggle>
<label for=section-efae8264f5fe410feb1b40be6f99baea class="flex justify-between"><a role=button>CS 229, Fall 2021</a></label><ul><li><a href=/notes/cs229/2021-09-21-intro/>Intro</a></li><li><a href=/notes/cs229/2021-09-23-supervised-learning-setup/>Supervised Learning Setup</a></li><li><a href=/notes/cs229/2021-09-28-logistic-regression/>Logistic Regression</a></li><li><a href=/notes/cs229/2021-09-30-generalized-linear-models/>Generalized Linear Models</a></li><li><a href=/notes/cs229/2021-10-05-generative-learning-algorithms/>Generative Learning Algorithms</a></li><li><a href=/notes/cs229/2021-10-07-naive-bayes/>Naive Bayes</a></li><li><a href=/notes/cs229/2021-10-12-kernel-methods-and-svm/>Kernel Methods and Svm</a></li><li><a href=/notes/cs229/2021-10-14-deep-learning/>Deep Learning</a></li><li><a href=/notes/cs229/2021-10-19-deep-learning-optimization/>Deep Learning Optimization</a></li><li><a href=/notes/cs229/2021-10-21-model-selection/>Model Selection</a></li></ul></li><li><input type=checkbox id=section-292ea4e126876f1048e61c4dc744546c class=toggle checked>
<label for=section-292ea4e126876f1048e61c4dc744546c class="flex justify-between"><a role=button>CS 251, Fall 2022</a></label><ul><li><a href=/notes/cs251/2022-09-26-intro/>Intro</a></li><li><a href=/notes/cs251/2022-09-28-bitcoin-mechanics/>Bitcoin Mechanics</a></li><li><a href=/notes/cs251/2022-10-03-bitcoin-scripts-and-wallets/>Bitcoin Scripts and Wallets</a></li><li><a href=/notes/cs251/2022-10-05-consensus/>Consensus</a></li><li><a href=/notes/cs251/2022-10-10-internet-consensus/>Internet Consensus</a></li><li><a href=/notes/cs251/2022-10-17-ethereum/ class=active>Ethereum</a></li><li><a href=/notes/cs251/2022-10-19-solidity/>Solidity</a></li><li><a href=/notes/cs251/2022-11-02-legal-aspects-and-regulation/>Legal Aspects and Regulation</a></li><li><a href=/notes/cs251/2022-11-07-privacy-and-deanonymization-and-mixing/>Privacy and Deanonymization and Mixing</a></li></ul></li><li><input type=checkbox id=section-98d861db134658b3e020a9d74c50ad24 class=toggle>
<label for=section-98d861db134658b3e020a9d74c50ad24 class="flex justify-between"><a role=button>CS 255, Winter 2022</a></label><ul><li><a href=/notes/cs255/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs255/2022-01-05-stream-ciphers/>Stream Ciphers</a></li><li><a href=/notes/cs255/2022-01-10-block-ciphers/>Block Ciphers</a></li><li><a href=/notes/cs255/2022-01-12-pseudorandom-functions/>Pseudorandom Functions</a></li><li><a href=/notes/cs255/2022-01-19-data-integrity-and-macs/>Data Integrity and Macs</a></li><li><a href=/notes/cs255/2022-01-24-collision-resistance/>Collision Resistance</a></li><li><a href=/notes/cs255/2022-01-26-authenticated-encryption/>Authenticated Encryption</a></li><li><a href=/notes/cs255/2022-01-31-key-management/>Key Management</a></li><li><a href=/notes/cs255/2022-02-02-key-exchange-math/>Key Exchange Math</a></li><li><a href=/notes/cs255/2022-02-07-public-key-encryption/>Public Key Encryption</a></li><li><a href=/notes/cs255/2022-02-09-pke-schemes/>Pke Schemes</a></li><li><a href=/notes/cs255/2022-02-14-digital-signatures/>Digital Signatures</a></li><li><a href=/notes/cs255/2022-02-16-certificates/>Certificates</a></li><li><a href=/notes/cs255/2022-02-23-id-protocols/>Id Protocols</a></li><li><a href=/notes/cs255/2022-02-28-key-exchange-protocols/>Key Exchange Protocols</a></li><li><a href=/notes/cs255/2022-03-02-zero-knowledge-protocols/>Zero Knowledge Protocols</a></li><li><a href=/notes/cs255/2022-03-07-quantum-cryptography/>Quantum Cryptography</a></li></ul></li><li><input type=checkbox id=section-568ed1bc8289796d56a6d06a22d7eb40 class=toggle>
<label for=section-568ed1bc8289796d56a6d06a22d7eb40 class="flex justify-between"><a role=button>INTLPOL 268, Fall 2021</a></label><ul><li><a href=/notes/intlpol268/2021-09-20-intro/>Intro</a></li><li><a href=/notes/intlpol268/2021-09-22-legal-intro-and-electronic-communications-privacy-act/>Legal Intro and Electronic Communications Privacy Act</a></li><li><a href=/notes/intlpol268/2021-09-27-web-requests-and-attacks/>Web Requests and Attacks</a></li><li><a href=/notes/intlpol268/2021-09-29-ecpa-for-private-actors/>Ecpa for Private Actors</a></li><li><a href=/notes/intlpol268/2021-10-04-cyberattacks/>Cyberattacks</a></li><li><a href=/notes/intlpol268/2021-10-06-computer-fraud-and-abuse-act/>Computer Fraud and Abuse Act</a></li><li><a href=/notes/intlpol268/2021-10-11-network-security/>Network Security</a></li><li><a href=/notes/intlpol268/2021-10-13-cfaa-dmca-and-security-research/>Cfaa Dmca and Security Research</a></li><li><a href=/notes/intlpol268/2021-10-20-data-security-laws/>Data Security Laws</a></li><li><a href=/notes/intlpol268/2021-10-25-corporate-intrusion/>Corporate Intrusion</a></li><li><a href=/notes/intlpol268/2021-10-27-ransomware-and-foreign-hackers/>Ransomware and Foreign Hackers</a></li><li><a href=/notes/intlpol268/2021-11-01-cryptography/>Cryptography</a></li><li><a href=/notes/intlpol268/2021-11-03-cyber-conflict/>Cyber Conflict</a></li><li><a href=/notes/intlpol268/2021-11-08-dark-web-and-cryptocurrencies/>Dark Web and Cryptocurrencies</a></li><li><a href=/notes/intlpol268/2021-11-10-encryption-and-technical-assistance/>Encryption and Technical Assistance</a></li><li><a href=/notes/intlpol268/2021-11-15-malware/>Malware</a></li><li><a href=/notes/intlpol268/2021-11-17-government-hacking/>Government Hacking</a></li><li><a href=/notes/intlpol268/2021-11-29-new-frontiers/>New Frontiers</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Ethereum</strong>
<label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ethereum>Ethereum</a><ul><li><a href=#limitations-of-bitcoin>Limitations of Bitcoin</a><ul><li><a href=#example-namecoin>Example: NameCoin</a></li></ul></li><li><a href=#cryptocurrencies-as-state-transition-systems>Cryptocurrencies as state transition systems</a></li><li><a href=#ethereum-applications>Ethereum applications</a></li><li><a href=#the-ethereum-system>The Ethereum system</a><ul><li><a href=#consensus-layer-proof-of-stake>Consensus layer: proof-of-stake</a></li><li><a href=#compute-layer-ethereum-virtual-machine>Compute layer: Ethereum Virtual Machine</a><ul><li><a href=#evm-structure-and-instructions>EVM structure and instructions</a></li><li><a href=#account-data>Account data</a></li><li><a href=#account-state-persistent-storage>Account state: persistent storage</a></li><li><a href=#state-transitions-tx-and-messages>State transitions: Tx and messages</a></li><li><a href=#an-ethereum-block>An Ethereum Block</a></li><li><a href=#gas-calculation>Gas calculation</a></li></ul></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=ethereum>Ethereum
<a class=anchor href=#ethereum>#</a></h1><h2 id=limitations-of-bitcoin>Limitations of Bitcoin
<a class=anchor href=#limitations-of-bitcoin>#</a></h2><ul><li>UTXO contains <code>ScriptPK</code> or hash thereof<ul><li>Simple script: indicates conditions when UTXO can be spent</li></ul></li><li>However: difficult to maintain state in multi-stage contracts or to enforce global rules on assets<ul><li>e.g. rate limiting: if wallet has 100 UTXOs, and want to enforce transfer of max 2BTC per day out of wallet, this is impossible!</li></ul></li></ul><h3 id=example-namecoin>Example: NameCoin
<a class=anchor href=#example-namecoin>#</a></h3><ul><li>DNS on the blockchain</li><li>Need operations:<ul><li><code>Name.new(OwnerAddr, DomainName)</code>: intent to register</li><li><code>Name.update(DomainName, newVal, newOwner, OwnerSig)</code></li><li><code>Name.lookup(DomainName)</code></li><li>note: also need to ensure no front-running on <code>Name.new()</code></li></ul></li><li>UTXO for new, update:<pre tabindex=0><code class=language-btc data-lang=btc>DUP HASH256 &lt;OwnerAddr&gt; EQVERIFY CHECKSIG VERIFY &lt;NAMECOIN&gt; &lt;DomainName&gt; &lt;IPAddr&gt; &lt;1&gt;
</code></pre><ul><li>Limitation: cannot enforce &ldquo;if I own a domain name, nobody else can register or update to that domain name&rdquo;</li><li>Required a fork of Bitcoin to achieve</li><li>However: gave rise to <strong>Ethereum</strong>, which natively supports global state</li></ul></li></ul><h2 id=cryptocurrencies-as-state-transition-systems>Cryptocurrencies as state transition systems
<a class=anchor href=#cryptocurrencies-as-state-transition-systems>#</a></h2><ul><li>Bitcoin: each transaction is a function mapping from set of possible world states, set of possible inputs -> set of possible world states<ul><li>Limited functionality in these transactions: the mutation only executes over UTXOs transforming one UTXO to another UTXO</li></ul></li><li>Ethereum: much richer state transaction function<ul><li>One transition executes an entire program</li></ul></li></ul><h2 id=ethereum-applications>Ethereum applications
<a class=anchor href=#ethereum-applications>#</a></h2><ul><li>Ethereum DApps include:<ul><li>New coins: ERC-20 standard interface</li><li>Decentralized finance: exchanges, lending, stablecoins, derivatives, etc</li><li>Insurance</li><li>Decentralized organizations</li><li>NFTs: managing asset ownership (ERC-721 interface)</li></ul></li><li>DApps run on:<ul><li>Base: consensus layer: beacon chain</li><li>Compute layer: execution chain</li><li>Create DApp w/Program Code, runs on compute layer mapping states to states with transactions as transitions</li></ul></li></ul><h2 id=the-ethereum-system>The Ethereum system
<a class=anchor href=#the-ethereum-system>#</a></h2><h3 id=consensus-layer-proof-of-stake>Consensus layer: proof-of-stake
<a class=anchor href=#consensus-layer-proof-of-stake>#</a></h3><ul><li>One block every 12 seconds; about 150 Tx per block<ul><li>Block proposer receives Tx fees for the block, along with other rewards</li></ul></li><li>Beacon chain: Eth2 (post-Sep. 2022) consensus layer<ul><li>Validators, not miners</li><li>To become a validator: stake (lock up) 32 ETH, or use Lido</li><li>Validators:<ul><li>Sign blocks to express correctness</li><li>Occasionally propose blocks (chosen at random)</li><li>Correct behavior: issued <em>new</em> ETH every epoch (32 blocks)</li><li>Incorrect behavior: slashed</li></ul></li></ul></li><li>When consensus reached: <code>notify_new_payload(payload)</code> (Engine API) called, sends transactions to compute layer</li></ul><h3 id=compute-layer-ethereum-virtual-machine>Compute layer: Ethereum Virtual Machine
<a class=anchor href=#compute-layer-ethereum-virtual-machine>#</a></h3><ul><li>World state: set of accounts identified by 32-byte address</li><li>Types of accounts:<ul><li>Owned accounts: controlled by ECDSA signing pair <code>(pk, sk)</code></li><li>Contracts: controlled by code (set at account creation time, does not change)</li></ul></li></ul><h4 id=evm-structure-and-instructions>EVM structure and instructions
<a class=anchor href=#evm-structure-and-instructions>#</a></h4><ul><li>Stack machine (like Bitcoin) but with JUMP (so loops allowed)<ul><li>Max stack depth = 1024</li><li>Program aborts if stack size exceeded; block proposer keeps gas</li><li>Contract can <em>create</em> or <em>call</em> another contract</li><li>Opcodes at <a href=https://evm.codes>evm.codes</a></li></ul></li><li>Two types of zero-initialized memory:<ul><li>Persistant storage (on blockchain), to use <code>SLOAD</code>, <code>SSTORE</code> (expensive)</li><li>Volatile memory (for single Tx): <code>MLOAD</code>, <code>MSTORE</code> (cheap)</li><li><code>LOG0(data)</code>: write data to log</li></ul></li><li>Every instruction costs gas:<ul><li><code>SSTORE &lt;addr>, &lt;value></code> (32 byte variables each)</li><li>zero -> nonzero: 20,000 gas</li><li>nonzero -> nonzero: 5,000 gas (for a cold slot)</li><li>nonzero -> zero: 15,000 gas refund (example)<ul><li>Refunds given for reducing size of blockchain state: incentivizes contracts to clean up after themselves</li><li>However: refund has a maximum, cannot make money by just cleaning up the blockchain</li></ul></li><li><code>CREATE</code>: 32,000 + 200x code size gas</li><li><code>CALL gas, addr, value, args</code>: call another contract</li><li><code>SELFDESTRUCT addr</code>: kill current contract, 5000 gas</li></ul></li></ul><h4 id=account-data>Account data
<a class=anchor href=#account-data>#</a></h4><ul><li>Address (computed):<ul><li>Owned, <code>H(pk)</code></li><li>Contracts: <code>H(CreatorAddr, CreatorNonce)</code></li></ul></li><li>Code:<ul><li>Owned: none</li><li>Contracts: <code>CodeHash</code></li></ul></li><li>Storage root (state):<ul><li>Owned: none</li><li>Contracts: <code>StorageRoot</code></li></ul></li><li>Balance (in Wei = 10-18 ETH, note GigaWei often used = 10-9 ETH)<ul><li>Both for humans and contracts</li></ul></li><li>Nonce:<ul><li>Both for humans and contracts</li><li>Nonce = number of Tx sent + number of accounts created: anti-replay mechanism</li></ul></li></ul><h4 id=account-state-persistent-storage>Account state: persistent storage
<a class=anchor href=#account-state-persistent-storage>#</a></h4><ul><li>Every contract has associated storage array <code>S[]</code> w/capacity 2256-1, where each cell holds 32 bytes, init to 0</li><li>Account storage root: Merkle Patricia Tree, keys are hash of <code>S[]</code><ul><li>Due to cannot compute full Merkle tree hash: 2256 leaves</li></ul></li></ul><h4 id=state-transitions-tx-and-messages>State transitions: Tx and messages
<a class=anchor href=#state-transitions-tx-and-messages>#</a></h4><ul><li>Transactions: signed data by initiator, fields:<ul><li>To: 32-byte address of target (0 means create new account)</li><li>From, [Signature]: initiator address and signature on Tx (if owned)</li><li>Value: # Wei being sent with Tx</li><li>Tx fees (EIP 1559): <code>gasLimit</code>, <code>maxFee</code>, <code>maxPriorityFee</code></li><li>if To = 0: create new contract <code>code = (init, body)</code></li><li>if To != 0: <code>data = (function, args)</code></li><li>Nonce: must match current nonce of sender (to prevent Tx replay)</li></ul></li><li>Transaction types:<ul><li>owned -> owned: transfer ETH between users</li><li>owned -> contract: call contract w/ETH and data</li><li>contract -> owned: contract sends funds to user</li><li>contract -> contract: one program calls another (and sends funds)<ul><li>Enables composability of contracts</li><li>One transaction from user can lead to many Tx processed</li></ul></li></ul></li></ul><h4 id=an-ethereum-block>An Ethereum Block
<a class=anchor href=#an-ethereum-block>#</a></h4><ul><li>Validators collect Txs from users => proposer creates a block of <code>n</code> Tx<ul><li>To produce block, do:<ul><li>for i = 1,&mldr;,n: execute state change of Txi sequentially (can change state of >n accounts)</li><li>record updated world state in block</li></ul></li><li>Other validators revalidate all Tx to verify block<ul><li>sign block if valid; if enough sigs, finalizes epoch</li></ul></li></ul></li><li>Block headers:<ul><li>Consensus data: proposer ID, parent hash, votes, etc</li><li>Address of gas beneficiary (Tx fee recipient)</li><li>World state root: updated world state<ul><li>Merkle Patricia Tree hash of all accounts in system</li></ul></li><li>Tx root: Merkle hash of all Tx processed in block</li><li>Tx receipt root: Merkle hash of all log messages generated in block</li><li>Gas used: used to adjust gas price (target 15M gas per block)</li></ul></li><li>Total blockchain size, ETH world, Oct. 2022: 12TB</li></ul><h4 id=gas-calculation>Gas calculation
<a class=anchor href=#gas-calculation>#</a></h4><ul><li>Why charge Tx fees (gas)?<ul><li>Gas prevents submitting Tx that runs for many steps</li><li>During high load: block proposes Tx from mempool that maximize its income<ul><li>Gas prices spike during congestion</li></ul></li></ul></li><li>Old EVM (prior to Aug. 2021):<ul><li>Every Tx contains a <code>gasPrice</code> &ldquo;bid&rdquo; (gas -> Wei conversion bid)</li><li>Producer chooses Tx w/highest <code>gasPrice</code> <code>(max sum(gasPrice * gasLimit))</code><ul><li>Not an efficient auction mechanism</li><li>Changed Aug. 2021 to second-choice auction type design</li></ul></li></ul></li><li>EIP1559 EVM gas calculation:<ul><li>Every block has a <code>baseFee</code>: minimum <code>gasPrice</code> for Tx in the block</li><li><code>baseFee</code> computed from total gas in earlier blocks<ul><li>Earlier blocks at gas limit (30M gas) - lots of congestion: base fees goes up 12.5% to discourage participation</li><li>Earlier blocks empty - no congestion: base fee decreases by 12.5% to encourage participation</li><li>If earlier blocks at &ldquo;target size&rdquo; (15M gas): base fee does not change</li></ul></li><li>Transaction specifies three parameters:<ul><li><code>gasLimit</code>: max total gas allowed for Tx</li><li><code>maxFee</code>: maximum allowed gas price</li><li><code>maxPriorityFee</code>: additional &ldquo;tip&rdquo; to be paid to block proposer</li></ul></li><li>Computed <code>gasPrice</code> bid in Wei: <code>gasPrice &lt;- min(maxFee, baseFee + maxPrioirityFee)</code><ul><li>Max gas: <code>gasLimit * gasPrice</code></li><li>Algorithm:<ol><li><code>if gasPrice &lt; baseFee</code>: abort</li><li>if <code>gasLimit * gasPrice > msg.sender.balance</code>: abort</li><li>deduct <code>gasLimit * gasPrice</code> from <code>msg.sender.balance</code></li><li>set <code>Gas &lt;- gasLimit</code></li><li>execute Tx: deduct gas from <code>Gas</code> for each instruction<ul><li>if at end <code>Gas &lt; 0</code>: abort, mark Tx invalid (proposer keeps <code>gasLimit * gasPrice</code>)</li></ul></li><li>Refund <code>Gas * gasPrice</code> to <code>msg.sender.balance</code> (leftover change)</li><li><code>gasUsed &lt;- gasLimit - Gas</code><ul><li>Burn <code>gasUsed * baseFee</code> (destroys ether, deflation)</li><li>Send <code>gasUsed * (gasPrice - baseFee)</code> to block producer (tip)</li></ul></li></ol></li></ul></li><li>Why burn ETH?<ul><li>Goals of EIP1559:<ul><li>Incentivize users to bid true utility for posting Tx</li><li>Incentivize block proposer to not create fake Tx</li><li>Disincentivize off-chain agreements</li></ul></li><li>Without burn (i.e., <code>baseFee</code> given to block producer):<ul><li>In periods of low Tx, volume proposer would try to increase volume by offering to refund <code>baseFee</code> off-chain to users</li></ul></li></ul></li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ethereum>Ethereum</a><ul><li><a href=#limitations-of-bitcoin>Limitations of Bitcoin</a><ul><li><a href=#example-namecoin>Example: NameCoin</a></li></ul></li><li><a href=#cryptocurrencies-as-state-transition-systems>Cryptocurrencies as state transition systems</a></li><li><a href=#ethereum-applications>Ethereum applications</a></li><li><a href=#the-ethereum-system>The Ethereum system</a><ul><li><a href=#consensus-layer-proof-of-stake>Consensus layer: proof-of-stake</a></li><li><a href=#compute-layer-ethereum-virtual-machine>Compute layer: Ethereum Virtual Machine</a><ul><li><a href=#evm-structure-and-instructions>EVM structure and instructions</a></li><li><a href=#account-data>Account data</a></li><li><a href=#account-state-persistent-storage>Account state: persistent storage</a></li><li><a href=#state-transitions-tx-and-messages>State transitions: Tx and messages</a></li><li><a href=#an-ethereum-block>An Ethereum Block</a></li><li><a href=#gas-calculation>Gas calculation</a></li></ul></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>