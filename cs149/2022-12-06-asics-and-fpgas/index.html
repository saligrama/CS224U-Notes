<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" Programming for Hardware Specialization on ASICs and FPGAs # Recall: performance and power, from 11/29&rsquo;s lecture
Designing an accelerator for an algorithm # Instead of becoming an expert in VHDL or Verilog, Chisel, etc:
High-level synthesis (HLS): Vivado HLS, Intel OpenCL, Xilinx SDAccel Restricted C with pragmas These tools sacrifice performance and are difficult to use Spatial: High-level language for designing HW accelerators Designed to enable specification of: Parallelism: specialized compute Locality: specialized memories and data movement Spatial: DSL for Accelerator design # Simplify configurable accelerator design Constructs to expressed: Parallel patterns as parallel and pipelined data paths Hierarchical control Explicit memory hierarchies Explicit parameters All parameters exposed to compiler Simple APIs to manage communication between CPU and accelerator Allows programmers to focus on &ldquo;interesting stuff&rdquo; Designed for performance-oriented programmers to exploit parallelism and locality More intuitive than CUDA: dataflow model rather than threading model Memory and register templates # // Memory hierarchy; typed storage templates val buffer = SRAM[UInt8](C) val image = DRAM[UInt8](H, W) // Registers val accum = Reg[Double] val fifo = FIFO[Float](D) val lbuf = LineBuffer[Int](R, C) val pixels = ShiftReg[UInt8](R, C) // Explicit transfers across memory hierarchy // Dense and sparse access buffer load image(i, j::j+c) buffer gather image(a, 10) Inner product in Spatial # // set up host and mem ptrs val output = ArgOut[Int] val vec1 = DRAM[Int](N) val vec2 = DRAM[Int](N) // Create accelerator Accel { // allocate on-chip memories val tile1 = SRAM[Int](tileSize) val tile2 = SRAM[Int](tileSize) // specify outer loop Reduce(output)(N by tileSize) { t => // prefetch data tile1 load vec1(t :: t + tileSize) tile2 load vec2(t :: t + tileSize) // Multiply-accumulate data val accum = Reg[Int](0) Reduce(accum)(tileSize by 1 par 1) { i => tile1(i) * tile2(i) }{a, b => a + b} }{a, b => a + b} } Generates multi-step controllers Manages communication with DRAM Complete app generates three-step control: Load -> Intra-tile accumulate -> full accumulate "><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content=" Programming for Hardware Specialization on ASICs and FPGAs # Recall: performance and power, from 11/29&rsquo;s lecture
Designing an accelerator for an algorithm # Instead of becoming an expert in VHDL or Verilog, Chisel, etc:
High-level synthesis (HLS): Vivado HLS, Intel OpenCL, Xilinx SDAccel Restricted C with pragmas These tools sacrifice performance and are difficult to use Spatial: High-level language for designing HW accelerators Designed to enable specification of: Parallelism: specialized compute Locality: specialized memories and data movement Spatial: DSL for Accelerator design # Simplify configurable accelerator design Constructs to expressed: Parallel patterns as parallel and pipelined data paths Hierarchical control Explicit memory hierarchies Explicit parameters All parameters exposed to compiler Simple APIs to manage communication between CPU and accelerator Allows programmers to focus on &ldquo;interesting stuff&rdquo; Designed for performance-oriented programmers to exploit parallelism and locality More intuitive than CUDA: dataflow model rather than threading model Memory and register templates # // Memory hierarchy; typed storage templates val buffer = SRAM[UInt8](C) val image = DRAM[UInt8](H, W) // Registers val accum = Reg[Double] val fifo = FIFO[Float](D) val lbuf = LineBuffer[Int](R, C) val pixels = ShiftReg[UInt8](R, C) // Explicit transfers across memory hierarchy // Dense and sparse access buffer load image(i, j::j+c) buffer gather image(a, 10) Inner product in Spatial # // set up host and mem ptrs val output = ArgOut[Int] val vec1 = DRAM[Int](N) val vec2 = DRAM[Int](N) // Create accelerator Accel { // allocate on-chip memories val tile1 = SRAM[Int](tileSize) val tile2 = SRAM[Int](tileSize) // specify outer loop Reduce(output)(N by tileSize) { t => // prefetch data tile1 load vec1(t :: t + tileSize) tile2 load vec2(t :: t + tileSize) // Multiply-accumulate data val accum = Reg[Int](0) Reduce(accum)(tileSize by 1 par 1) { i => tile1(i) * tile2(i) }{a, b => a + b} }{a, b => a + b} } Generates multi-step controllers Manages communication with DRAM Complete app generates three-step control: Load -> Intra-tile accumulate -> full accumulate "><meta property="og:type" content="article"><meta property="og:url" content="https://saligrama.io/notes/cs149/2022-12-06-asics-and-fpgas/"><meta property="article:section" content="cs149"><title>Asics and Fpgas | Aditya's notes</title><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.395a67680f48b8d23bbf267f26d0d1259e69554b2b704e371e8e15cbe656e05f.css integrity="sha256-OVpnaA9IuNI7vyZ/JtDRJZ5pVUsrcE43Ho4Vy+ZW4F8=" crossorigin=anonymous><script defer src=/notes/flexsearch.min.js></script>
<script defer src=/notes/en.search.min.767098043f335b91e601b9899955827164c1342edd249220b80bd52a6c6937c2.js integrity="sha256-dnCYBD8zW5HmAbmJmVWCcWTBNC7dJJIguAvVKmxpN8I=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><span>Aditya's notes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-a88f46c31d1ebdf165810583424fda37 class=toggle>
<label for=section-a88f46c31d1ebdf165810583424fda37 class="flex justify-between"><a role=button>CS 103, Fall 2020</a></label><ul><li><a href=/notes/cs103/2020-09-16-set-theory/>Set Theory</a></li><li><a href=/notes/cs103/2020-09-18-indirect-proofs/>Indirect Proofs</a></li><li><a href=/notes/cs103/2020-09-18-mathematical-proofs/>Mathematical Proofs</a></li><li><a href=/notes/cs103/2020-09-26-first-order-logic/>First Order Logic</a></li><li><a href=/notes/cs103/2020-09-26-propositional-logic/>Propositional Logic</a></li><li><a href=/notes/cs103/2020-09-27-first-order-logic-continued/>First Order Logic Continued</a></li><li><a href=/notes/cs103/2020-09-30-binary-relations/>Binary Relations</a></li><li><a href=/notes/cs103/2020-10-01-binary-relations-continued/>Binary Relations Continued</a></li><li><a href=/notes/cs103/2020-10-04-functions/>Functions</a></li><li><a href=/notes/cs103/2020-10-10-cardinality/>Cardinality</a></li><li><a href=/notes/cs103/2020-10-11-graph-theory/>Graph Theory</a></li><li><a href=/notes/cs103/2020-10-17-pigeonhole-principle/>Pigeonhole Principle</a></li><li><a href=/notes/cs103/2020-10-18-induction/>Induction</a></li><li><a href=/notes/cs103/2020-10-19-induction-variants/>Induction Variants</a></li><li><a href=/notes/cs103/2020-10-20-computability-and-formal-languages/>Computability and Formal Languages</a></li><li><a href=/notes/cs103/2020-10-25-nondeterministic-finite-automata/>Nondeterministic Finite Automata</a></li><li><a href=/notes/cs103/2020-10-26-nfa-dfa-equivalence/>Nfa Dfa Equivalence</a></li><li><a href=/notes/cs103/2020-10-26-regular-expressions/>Regular Expressions</a></li><li><a href=/notes/cs103/2020-11-01-nonregular-languages/>Nonregular Languages</a></li><li><a href=/notes/cs103/2020-11-02-context-free-grammars/>Context Free Grammars</a></li><li><a href=/notes/cs103/2020-11-03-turing-machines/>Turing Machines</a></li><li><a href=/notes/cs103/2020-11-08-turing-machine-subroutines/>Turing Machine Subroutines</a></li><li><a href=/notes/cs103/2020-11-08-universal-turing-machine/>Universal Turing Machine</a></li><li><a href=/notes/cs103/2020-11-08-unsolvable-problems/>Unsolvable Problems</a></li><li><a href=/notes/cs103/2020-11-14-unsolvable-problems-continued/>Unsolvable Problems Continued</a></li></ul></li><li><input type=checkbox id=section-cf13475a7a80a5dd57b5a55dce73d171 class=toggle>
<label for=section-cf13475a7a80a5dd57b5a55dce73d171 class="flex justify-between"><a role=button>CS 107, Fall 2020</a></label><ul><li><a href=/notes/cs107/2020-09-18-integer-representations/>Integer Representations</a></li><li><a href=/notes/cs107/2020-09-21-bitwise-operations/>Bitwise Operations</a></li><li><a href=/notes/cs107/2020-09-25-c-chars-and-strings/>C Chars and Strings</a></li><li><a href=/notes/cs107/2020-09-28-more-c-strings/>More C Strings</a></li><li><a href=/notes/cs107/2020-10-02-pointers-arrays/>Pointers Arrays</a></li><li><a href=/notes/cs107/2020-10-05-stack-and-heap/>Stack and Heap</a></li><li><a href=/notes/cs107/2020-10-09-c-generics/>C Generics</a></li><li><a href=/notes/cs107/2020-10-12-function-pointers/>Function Pointers</a></li><li><a href=/notes/cs107/2020-10-16-assembly/>Assembly</a></li><li><a href=/notes/cs107/2020-10-19-assembly-arithmetic-logic/>Assembly Arithmetic Logic</a></li><li><a href=/notes/cs107/2020-10-23-assembly-control-flow/>Assembly Control Flow</a></li><li><a href=/notes/cs107/2020-10-26-assembly-function-calls-and-return-stack/>Assembly Function Calls and Return Stack</a></li><li><a href=/notes/cs107/2020-10-30-heap-management/>Heap Management</a></li><li><a href=/notes/cs107/2020-11-09-program-optimization/>Program Optimization</a></li></ul></li><li><input type=checkbox id=section-4e3bc6e2f7a0feae33c3e43356d49c80 class=toggle>
<label for=section-4e3bc6e2f7a0feae33c3e43356d49c80 class="flex justify-between"><a role=button>CS 110L, Spring 2021</a></label><ul><li><a href=/notes/cs110l/2021-03-30-course-overview/>Course Overview</a></li><li><a href=/notes/cs110l/2021-04-01-fixing-c/>Fixing C</a></li><li><a href=/notes/cs110l/2021-04-06-intro-to-rust/>Intro to Rust</a></li><li><a href=/notes/cs110l/2021-04-08-ownership/>Ownership</a></li><li><a href=/notes/cs110l/2021-04-13-error-handling/>Error Handling</a></li><li><a href=/notes/cs110l/2021-04-22-traits/>Traits</a></li><li><a href=/notes/cs110l/2021-04-27-generics/>Generics</a></li><li><a href=/notes/cs110l/2021-04-29-multiprocessing/>Multiprocessing</a></li></ul></li><li><input type=checkbox id=section-23e7773af736437c02202412a988f2db class=toggle>
<label for=section-23e7773af736437c02202412a988f2db class="flex justify-between"><a role=button>CS 111, Spring 2021</a></label><ul><li><a href=/notes/cs111/2021-03-31-threads-and-dispatching/>Threads and Dispatching</a></li><li><a href=/notes/cs111/2021-04-02-concurrency/>Concurrency</a></li><li><a href=/notes/cs111/2021-04-05-synchronization/>Synchronization</a></li><li><a href=/notes/cs111/2021-04-07-shared-memory-and-condition-variables-and-locks/>Shared Memory and Condition Variables and Locks</a></li><li><a href=/notes/cs111/2021-04-09-lock-implementation-and-deadlocking/>Lock Implementation and Deadlocking</a></li><li><a href=/notes/cs111/2021-04-12-scheduling/>Scheduling</a></li><li><a href=/notes/cs111/2021-04-14-multiprocessing/>Multiprocessing</a></li><li><a href=/notes/cs111/2021-04-16-linking/>Linking</a></li><li><a href=/notes/cs111/2021-04-19-storage-management/>Storage Management</a></li><li><a href=/notes/cs111/2021-04-21-virtual-memory/>Virtual Memory</a></li><li><a href=/notes/cs111/2021-04-23-dynamic-address-translation/>Dynamic Address Translation</a></li><li><a href=/notes/cs111/2021-04-26-segmentation-and-paging/>Segmentation and Paging</a></li><li><a href=/notes/cs111/2021-04-30-demand-paging/>Demand Paging</a></li><li><a href=/notes/cs111/2021-05-05-disks/>Disks</a></li><li><a href=/notes/cs111/2021-05-07-file-systems/>File Systems</a></li><li><a href=/notes/cs111/2021-05-10-realworld-filesystem-structures/>Realworld Filesystem Structures</a></li><li><a href=/notes/cs111/2021-05-12-directories/>Directories</a></li><li><a href=/notes/cs111/2021-05-14-crash-recovery/>Crash Recovery</a></li><li><a href=/notes/cs111/2021-05-19-protection/>Protection</a></li><li><a href=/notes/cs111/2021-05-24-flash-memory/>Flash Memory</a></li><li><a href=/notes/cs111/2021-05-28-virtual-machines/>Virtual Machines</a></li></ul></li><li><input type=checkbox id=section-a586b190ebf0a4874cd21a1d76743261 class=toggle>
<label for=section-a586b190ebf0a4874cd21a1d76743261 class="flex justify-between"><a role=button>CS 143, Spring 2022</a></label><ul><li><a href=/notes/cs143/2022-03-29-intro/>Intro</a></li><li><a href=/notes/cs143/2022-03-31-language-design-and-cool/>Language Design and Cool</a></li><li><a href=/notes/cs143/2022-04-05-lexical-analysis/>Lexical Analysis</a></li><li><a href=/notes/cs143/2022-04-07-lexical-analysis-implementation/>Lexical Analysis Implementation</a></li><li><a href=/notes/cs143/2022-04-12-parsing/>Parsing</a></li><li><a href=/notes/cs143/2022-04-14-syntax-directed-translation/>Syntax Directed Translation</a></li><li><a href=/notes/cs143/2022-04-19-top-down-parsing/>Top Down Parsing</a></li><li><a href=/notes/cs143/2022-04-26-semantic-analysis/>Semantic Analysis</a></li></ul></li><li><input type=checkbox id=section-37836de7a703e433b2642097d511f482 class=toggle checked>
<label for=section-37836de7a703e433b2642097d511f482 class="flex justify-between"><a role=button>CS 149, Fall 2022</a></label><ul><li><a href=/notes/cs149/2022-09-27-intro/>Intro</a></li><li><a href=/notes/cs149/2022-09-29-modern-multicore-processors/>Modern Multicore Processors</a></li><li><a href=/notes/cs149/2022-10-04-parallel-abstractions/>Parallel Abstractions</a></li><li><a href=/notes/cs149/2022-10-06-parallel-models/>Parallel Models</a></li><li><a href=/notes/cs149/2022-10-11-work-distribution-and-scheduling/>Work Distribution and Scheduling</a></li><li><a href=/notes/cs149/2022-10-13-locality-communication-and-contention/>Locality Communication and Contention</a></li><li><a href=/notes/cs149/2022-10-18-gpu-architecture-and-cuda/>Gpu Architecture and Cuda</a></li><li><a href=/notes/cs149/2022-10-20-data-parallel-architecture/>Data Parallel Architecture</a></li><li><a href=/notes/cs149/2022-10-25-spark/>Spark</a></li><li><a href=/notes/cs149/2022-10-27-cache-coherence/>Cache Coherence</a></li><li><a href=/notes/cs149/2022-11-01-memory-consistency/>Memory Consistency</a></li><li><a href=/notes/cs149/2022-11-03-lock-implementation-and-lock-free-programming/>Lock Implementation and Lock Free Programming</a></li><li><a href=/notes/cs149/2022-11-10-transactional-memory/>Transactional Memory</a></li><li><a href=/notes/cs149/2022-11-29-heterogeneous-processing-and-domain-specific-languages/>Heterogeneous Processing and Domain Specific Languages</a></li><li><a href=/notes/cs149/2022-12-06-asics-and-fpgas/ class=active>Asics and Fpgas</a></li></ul></li><li><input type=checkbox id=section-4f9fa520660f975442d4640415905b3c class=toggle>
<label for=section-4f9fa520660f975442d4640415905b3c class="flex justify-between"><a role=button>CS 154, Fall 2021</a></label><ul><li><a href=/notes/cs154/2021-09-28-finite-automata/>Finite Automata</a></li><li><a href=/notes/cs154/2021-10-05-pumping-lemma-and-myhill-nerode/>Pumping Lemma and Myhill Nerode</a></li><li><a href=/notes/cs154/2021-10-12-streaming-algorithms-and-turing-machines/>Streaming Algorithms and Turing Machines</a></li></ul></li><li><input type=checkbox id=section-d24cd7d7d21fe73135d596a09b50887f class=toggle>
<label for=section-d24cd7d7d21fe73135d596a09b50887f class="flex justify-between"><a role=button>CS 155, Spring 2022</a></label><ul><li><a href=/notes/cs155/2022-03-28-intro/>Intro</a></li><li><a href=/notes/cs155/2022-03-30-control-hijacking/>Control Hijacking</a></li><li><a href=/notes/cs155/2022-04-04-control-hijacking-defenses/>Control Hijacking Defenses</a></li><li><a href=/notes/cs155/2022-04-06-security-principles/>Security Principles</a></li><li><a href=/notes/cs155/2022-04-11-isolation-and-sandboxing/>Isolation and Sandboxing</a></li><li><a href=/notes/cs155/2022-04-13-vuln-finding/>Vuln Finding</a></li><li><a href=/notes/cs155/2022-04-18-web-security/>Web Security</a></li><li><a href=/notes/cs155/2022-04-20-web-attacks/>Web Attacks</a></li><li><a href=/notes/cs155/2022-04-25-web-defenses/>Web Defenses</a></li><li><a href=/notes/cs155/2022-05-04-processor-security/>Processor Security</a></li><li><a href=/notes/cs155/2022-05-09-internet-protocol-security/>Internet Protocol Security</a></li></ul></li><li><input type=checkbox id=section-471622039e8d87cd8d642483c8d218b8 class=toggle>
<label for=section-471622039e8d87cd8d642483c8d218b8 class="flex justify-between"><a role=button>CS 161, Winter 2022</a></label><ul><li><a href=/notes/cs161/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs161/2022-01-05-worst-case-and-asymptotic-analysis/>Worst Case and Asymptotic Analysis</a></li><li><a href=/notes/cs161/2022-01-10-recurrence-relations/>Recurrence Relations</a></li><li><a href=/notes/cs161/2022-01-12-median-and-selection/>Median and Selection</a></li><li><a href=/notes/cs161/2022-01-19-randomized-algorithms-and-quicksort/>Randomized Algorithms and Quicksort</a></li><li><a href=/notes/cs161/2022-01-24-sorting-lower-bounds/>Sorting Lower Bounds</a></li><li><a href=/notes/cs161/2022-01-26-binary-search-trees/>Binary Search Trees</a></li><li><a href=/notes/cs161/2022-01-31-hashing/>Hashing</a></li><li><a href=/notes/cs161/2022-02-02-graphs-and-graph-search/>Graphs and Graph Search</a></li><li><a href=/notes/cs161/2022-02-07-strongly-connected-components/>Strongly Connected Components</a></li><li><a href=/notes/cs161/2022-02-09-weighted-graphs-and-dijkstra/>Weighted Graphs and Dijkstra</a></li><li><a href=/notes/cs161/2022-02-14-dynamic-programming/>Dynamic Programming</a></li><li><a href=/notes/cs161/2022-02-16-dynamic-programming-applications/>Dynamic Programming Applications</a></li><li><a href=/notes/cs161/2022-02-23-greedy-algorithms/>Greedy Algorithms</a></li><li><a href=/notes/cs161/2022-02-28-minimum-spanning-trees/>Minimum Spanning Trees</a></li></ul></li><li><input type=checkbox id=section-0794dc87987599843ba69a8ea82e9b6a class=toggle>
<label for=section-0794dc87987599843ba69a8ea82e9b6a class="flex justify-between"><a role=button>CS 224U, Spring 2021</a></label><ul><li><a href=/notes/cs224u/2021-03-29-course-overview/>Course Overview</a></li><li><a href=/notes/cs224u/2021-03-31-vector-space-models/>Vector Space Models</a></li><li><a href=/notes/cs224u/2021-04-12-sentiment-analysis/>Sentiment Analysis</a></li></ul></li><li><input type=checkbox id=section-efae8264f5fe410feb1b40be6f99baea class=toggle>
<label for=section-efae8264f5fe410feb1b40be6f99baea class="flex justify-between"><a role=button>CS 229, Fall 2021</a></label><ul><li><a href=/notes/cs229/2021-09-21-intro/>Intro</a></li><li><a href=/notes/cs229/2021-09-23-supervised-learning-setup/>Supervised Learning Setup</a></li><li><a href=/notes/cs229/2021-09-28-logistic-regression/>Logistic Regression</a></li><li><a href=/notes/cs229/2021-09-30-generalized-linear-models/>Generalized Linear Models</a></li><li><a href=/notes/cs229/2021-10-05-generative-learning-algorithms/>Generative Learning Algorithms</a></li><li><a href=/notes/cs229/2021-10-07-naive-bayes/>Naive Bayes</a></li><li><a href=/notes/cs229/2021-10-12-kernel-methods-and-svm/>Kernel Methods and Svm</a></li><li><a href=/notes/cs229/2021-10-14-deep-learning/>Deep Learning</a></li><li><a href=/notes/cs229/2021-10-19-deep-learning-optimization/>Deep Learning Optimization</a></li><li><a href=/notes/cs229/2021-10-21-model-selection/>Model Selection</a></li></ul></li><li><input type=checkbox id=section-58493bdbfe80396f07f44c40ecf068c8 class=toggle>
<label for=section-58493bdbfe80396f07f44c40ecf068c8 class="flex justify-between"><a role=button>CS 249I, Winter 2023</a></label><ul><li><a href=/notes/cs249i/2023-01-09-internet-players/>Internet Players</a></li><li><a href=/notes/cs249i/2023-01-18-modern-routing-practices/>Modern Routing Practices</a></li></ul></li><li><input type=checkbox id=section-292ea4e126876f1048e61c4dc744546c class=toggle>
<label for=section-292ea4e126876f1048e61c4dc744546c class="flex justify-between"><a role=button>CS 251, Fall 2022</a></label><ul><li><a href=/notes/cs251/2022-09-26-intro/>Intro</a></li><li><a href=/notes/cs251/2022-09-28-bitcoin-mechanics/>Bitcoin Mechanics</a></li><li><a href=/notes/cs251/2022-10-03-bitcoin-scripts-and-wallets/>Bitcoin Scripts and Wallets</a></li><li><a href=/notes/cs251/2022-10-05-consensus/>Consensus</a></li><li><a href=/notes/cs251/2022-10-10-internet-consensus/>Internet Consensus</a></li><li><a href=/notes/cs251/2022-10-17-ethereum/>Ethereum</a></li><li><a href=/notes/cs251/2022-10-19-solidity/>Solidity</a></li><li><a href=/notes/cs251/2022-11-02-legal-aspects-and-regulation/>Legal Aspects and Regulation</a></li><li><a href=/notes/cs251/2022-11-07-privacy-and-deanonymization-and-mixing/>Privacy and Deanonymization and Mixing</a></li><li><a href=/notes/cs251/2022-11-09-privacy-via-zk-snarks/>Privacy via Zk Snarks</a></li></ul></li><li><input type=checkbox id=section-98d861db134658b3e020a9d74c50ad24 class=toggle>
<label for=section-98d861db134658b3e020a9d74c50ad24 class="flex justify-between"><a role=button>CS 255, Winter 2022</a></label><ul><li><a href=/notes/cs255/2022-01-03-intro/>Intro</a></li><li><a href=/notes/cs255/2022-01-05-stream-ciphers/>Stream Ciphers</a></li><li><a href=/notes/cs255/2022-01-10-block-ciphers/>Block Ciphers</a></li><li><a href=/notes/cs255/2022-01-12-pseudorandom-functions/>Pseudorandom Functions</a></li><li><a href=/notes/cs255/2022-01-19-data-integrity-and-macs/>Data Integrity and Macs</a></li><li><a href=/notes/cs255/2022-01-24-collision-resistance/>Collision Resistance</a></li><li><a href=/notes/cs255/2022-01-26-authenticated-encryption/>Authenticated Encryption</a></li><li><a href=/notes/cs255/2022-01-31-key-management/>Key Management</a></li><li><a href=/notes/cs255/2022-02-02-key-exchange-math/>Key Exchange Math</a></li><li><a href=/notes/cs255/2022-02-07-public-key-encryption/>Public Key Encryption</a></li><li><a href=/notes/cs255/2022-02-09-pke-schemes/>Pke Schemes</a></li><li><a href=/notes/cs255/2022-02-14-digital-signatures/>Digital Signatures</a></li><li><a href=/notes/cs255/2022-02-16-certificates/>Certificates</a></li><li><a href=/notes/cs255/2022-02-23-id-protocols/>Id Protocols</a></li><li><a href=/notes/cs255/2022-02-28-key-exchange-protocols/>Key Exchange Protocols</a></li><li><a href=/notes/cs255/2022-03-02-zero-knowledge-protocols/>Zero Knowledge Protocols</a></li><li><a href=/notes/cs255/2022-03-07-quantum-cryptography/>Quantum Cryptography</a></li></ul></li><li><input type=checkbox id=section-3c4550884ed49f470e55fabac7077d16 class=toggle>
<label for=section-3c4550884ed49f470e55fabac7077d16 class="flex justify-between"><a role=button>Cs153</a></label><ul><li><a href=/notes/cs153/2023-01-12-intro/>Intro</a></li></ul></li><li><input type=checkbox id=section-568ed1bc8289796d56a6d06a22d7eb40 class=toggle>
<label for=section-568ed1bc8289796d56a6d06a22d7eb40 class="flex justify-between"><a role=button>INTLPOL 268, Fall 2021</a></label><ul><li><a href=/notes/intlpol268/2021-09-20-intro/>Intro</a></li><li><a href=/notes/intlpol268/2021-09-22-legal-intro-and-electronic-communications-privacy-act/>Legal Intro and Electronic Communications Privacy Act</a></li><li><a href=/notes/intlpol268/2021-09-27-web-requests-and-attacks/>Web Requests and Attacks</a></li><li><a href=/notes/intlpol268/2021-09-29-ecpa-for-private-actors/>Ecpa for Private Actors</a></li><li><a href=/notes/intlpol268/2021-10-04-cyberattacks/>Cyberattacks</a></li><li><a href=/notes/intlpol268/2021-10-06-computer-fraud-and-abuse-act/>Computer Fraud and Abuse Act</a></li><li><a href=/notes/intlpol268/2021-10-11-network-security/>Network Security</a></li><li><a href=/notes/intlpol268/2021-10-13-cfaa-dmca-and-security-research/>Cfaa Dmca and Security Research</a></li><li><a href=/notes/intlpol268/2021-10-20-data-security-laws/>Data Security Laws</a></li><li><a href=/notes/intlpol268/2021-10-25-corporate-intrusion/>Corporate Intrusion</a></li><li><a href=/notes/intlpol268/2021-10-27-ransomware-and-foreign-hackers/>Ransomware and Foreign Hackers</a></li><li><a href=/notes/intlpol268/2021-11-01-cryptography/>Cryptography</a></li><li><a href=/notes/intlpol268/2021-11-03-cyber-conflict/>Cyber Conflict</a></li><li><a href=/notes/intlpol268/2021-11-08-dark-web-and-cryptocurrencies/>Dark Web and Cryptocurrencies</a></li><li><a href=/notes/intlpol268/2021-11-10-encryption-and-technical-assistance/>Encryption and Technical Assistance</a></li><li><a href=/notes/intlpol268/2021-11-15-malware/>Malware</a></li><li><a href=/notes/intlpol268/2021-11-17-government-hacking/>Government Hacking</a></li><li><a href=/notes/intlpol268/2021-11-29-new-frontiers/>New Frontiers</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Asics and Fpgas</strong>
<label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#programming-for-hardware-specialization-on-asics-and-fpgas>Programming for Hardware Specialization on ASICs and FPGAs</a><ul><li><a href=#designing-an-accelerator-for-an-algorithm>Designing an accelerator for an algorithm</a></li><li><a href=#spatial-dsl-for-accelerator-design>Spatial: DSL for Accelerator design</a><ul><li><a href=#memory-and-register-templates>Memory and register templates</a></li><li><a href=#inner-product-in-spatial>Inner product in Spatial</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=programming-for-hardware-specialization-on-asics-and-fpgas>Programming for Hardware Specialization on ASICs and FPGAs
<a class=anchor href=#programming-for-hardware-specialization-on-asics-and-fpgas>#</a></h1><p>Recall: <a href=/notes/cs149/2022-11-29-heterogeneous-processing-and-domain-specific-languages/#performance-and-power>performance and power</a>, from 11/29&rsquo;s lecture</p><h2 id=designing-an-accelerator-for-an-algorithm>Designing an accelerator for an algorithm
<a class=anchor href=#designing-an-accelerator-for-an-algorithm>#</a></h2><p>Instead of becoming an expert in VHDL or Verilog, Chisel, etc:</p><ul><li>High-level synthesis (HLS): Vivado HLS, Intel OpenCL, Xilinx SDAccel<ul><li>Restricted C with pragmas</li><li>These tools sacrifice performance and are difficult to use</li></ul></li><li>Spatial: High-level language for designing HW accelerators<ul><li>Designed to enable specification of:<ul><li>Parallelism: specialized compute</li><li>Locality: specialized memories and data movement</li></ul></li></ul></li></ul><h2 id=spatial-dsl-for-accelerator-design>Spatial: DSL for Accelerator design
<a class=anchor href=#spatial-dsl-for-accelerator-design>#</a></h2><ul><li>Simplify configurable accelerator design<ul><li>Constructs to expressed:<ul><li>Parallel patterns as parallel and pipelined data paths</li><li>Hierarchical control</li><li>Explicit memory hierarchies</li><li>Explicit parameters</li></ul></li><li>All parameters exposed to compiler</li><li>Simple APIs to manage communication between CPU and accelerator</li></ul></li><li>Allows programmers to focus on &ldquo;interesting stuff&rdquo;<ul><li>Designed for performance-oriented programmers to exploit parallelism and locality</li><li>More intuitive than CUDA: dataflow model rather than threading model</li></ul></li></ul><h3 id=memory-and-register-templates>Memory and register templates
<a class=anchor href=#memory-and-register-templates>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#6272a4>// Memory hierarchy; typed storage templates
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>val</span> buffer <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>SRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>UInt8</span><span style=color:#ff79c6>](</span>C<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> image <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>DRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>UInt8</span><span style=color:#ff79c6>](</span>H<span style=color:#ff79c6>,</span> W<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Registers
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>val</span> accum <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>Reg</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Double</span><span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> fifo <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>FIFO</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Float</span><span style=color:#ff79c6>](</span>D<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> lbuf <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>LineBuffer</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span>R<span style=color:#ff79c6>,</span> C<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> pixels <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>ShiftReg</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>UInt8</span><span style=color:#ff79c6>](</span>R<span style=color:#ff79c6>,</span> C<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Explicit transfers across memory hierarchy
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// Dense and sparse access
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>buffer load image<span style=color:#ff79c6>(</span>i<span style=color:#ff79c6>,</span> j<span style=color:#ff79c6>:</span><span style=color:#8be9fd>:j+c</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>buffer gather image<span style=color:#ff79c6>(</span>a<span style=color:#ff79c6>,</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>)</span>
</span></span></code></pre></div><h3 id=inner-product-in-spatial>Inner product in Spatial
<a class=anchor href=#inner-product-in-spatial>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#6272a4>// set up host and mem ptrs
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>val</span> output <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>ArgOut</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> vec1 <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>DRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span>N<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>val</span> vec2 <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>DRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span>N<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Create accelerator
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#50fa7b>Accel</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// allocate on-chip memories
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>val</span> tile1 <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>SRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span>tileSize<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>val</span> tile2 <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>SRAM</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span>tileSize<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// specify outer loop
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>Reduce</span><span style=color:#ff79c6>(</span>output<span style=color:#ff79c6>)(</span>N by tileSize<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span> t <span style=color:#ff79c6>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// prefetch data
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        tile1 load vec1<span style=color:#ff79c6>(</span>t <span style=color:#ff79c6>:</span><span style=color:#8be9fd>:</span> <span style=color:#8be9fd>t</span> <span style=color:#8be9fd>+</span> <span style=color:#8be9fd>tileSize</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>        tile2 load vec2<span style=color:#ff79c6>(</span>t <span style=color:#ff79c6>:</span><span style=color:#8be9fd>:</span> <span style=color:#8be9fd>t</span> <span style=color:#8be9fd>+</span> <span style=color:#8be9fd>tileSize</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Multiply-accumulate data
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>val</span> accum <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>Reg</span><span style=color:#ff79c6>[</span><span style=color:#8be9fd>Int</span><span style=color:#ff79c6>](</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>        <span style=color:#50fa7b>Reduce</span><span style=color:#ff79c6>(</span>accum<span style=color:#ff79c6>)(</span>tileSize by <span style=color:#bd93f9>1</span> par <span style=color:#bd93f9>1</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span> i <span style=color:#ff79c6>=&gt;</span>
</span></span><span style=display:flex><span>            tile1<span style=color:#ff79c6>(</span>i<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>*</span> tile2<span style=color:#ff79c6>(</span>i<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}{</span>a<span style=color:#ff79c6>,</span> b <span style=color:#ff79c6>=&gt;</span> a <span style=color:#ff79c6>+</span> b<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}{</span>a<span style=color:#ff79c6>,</span> b <span style=color:#ff79c6>=&gt;</span> a <span style=color:#ff79c6>+</span> b<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><ul><li>Generates multi-step controllers</li><li>Manages communication with DRAM</li><li>Complete app generates three-step control: Load -> Intra-tile accumulate -> full accumulate</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#programming-for-hardware-specialization-on-asics-and-fpgas>Programming for Hardware Specialization on ASICs and FPGAs</a><ul><li><a href=#designing-an-accelerator-for-an-algorithm>Designing an accelerator for an algorithm</a></li><li><a href=#spatial-dsl-for-accelerator-design>Spatial: DSL for Accelerator design</a><ul><li><a href=#memory-and-register-templates>Memory and register templates</a></li><li><a href=#inner-product-in-spatial>Inner product in Spatial</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>